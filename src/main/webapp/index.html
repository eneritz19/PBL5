<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0EA5E9">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <title>SkinXpert - Detección Inteligente de Problemas de Piel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", sans-serif;
            letter-spacing: -0.022em;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            font-weight: 600;
            letter-spacing: -0.03em;
        }

        :root {
            --sk-blue-dark: #003366;
            --sk-blue-light: #0EA5E9;
            --sk-cyan-ia: #00e5ff;
            --sk-secondary: #F0F9FF;
            --sk-accent: #E0F2FE;
            --sidebar-width: 340px;
            --text-secondary: #64748B;
            --bg-primary: #ffffff;
            --text-primary: #1d1d1f;
            --card-bg: #ffffff;
            --input-bg: #f5f5f7;
        }

        /* MODO OSCURO MANUAL */
        body.dark-mode {
            background: #000000 !important;
            color: #ffffff !important;
        }

        body.dark-mode .case-card {
            background: #000000 !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            color: #ffffff !important;
        }

        body.dark-mode input,
        body.dark-mode textarea,
        body.dark-mode select {
            background: #1a1a1a !important;
            color: #ffffff !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        body.dark-mode .container {
            background: #000000 !important;
            color: #ffffff !important;
        }

        body.dark-mode h2,
        body.dark-mode h3,
        body.dark-mode h4,
        body.dark-mode p,
        body.dark-mode span,
        body.dark-mode strong,
        body.dark-mode label {
            color: #ffffff !important;
        }

        body.dark-mode .tabs {
            background: #1a1a1a !important;
        }

        body.dark-mode .tab-btn {
            color: #ffffff !important;
        }

        body.dark-mode .tab-btn.active {
            background: #2d2d2d !important;
        }

        body.dark-mode .modal-content {
            background: #1a1a1a !important;
            color: #ffffff !important;
        }

        body.dark-mode .modal-content h3 {
            color: #ffffff !important;
        }

        body.dark-mode .btn-secondary {
            background: #2d2d2d !important;
            color: #ffffff !important;
        }

        body.dark-mode .footer {
            background: #000000 !important;
            color: #ffffff !important;
        }

        body.dark-mode #speechStatus {
            background: #1a1a1a !important;
            color: #ffffff !important;
        }

        /* Botón de modo oscuro - igual que btn-secondary */
        .dark-mode-toggle {
            background: #0EA5E9;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            width: auto;
            margin: 0;
            color: #ffffff;
        }

        .dark-mode-toggle:hover {
            background: #0284c7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
        }

        .dark-mode-toggle i {
            color: #ffffff;
        }

        body.dark-mode .dark-mode-toggle {
            background: #0EA5E9;
            color: #ffffff;
        }
        
        body.dark-mode .dark-mode-toggle i {
            color: #ffffff;
        }

        body.dark-mode .role-badge {
            background: #1a1a1a !important;
            color: #0EA5E9 !important;
        }

        body.dark-mode .urgency-badge {
            color: #000000 !important;
        }

        body.dark-mode #doctorPendingList p,
        body.dark-mode #doctorPatientsList p,
        body.dark-mode #patientHistoryList p,
        body.dark-mode #adminDoctorsList p,
        body.dark-mode #adminPatientsList p {
            color: #ffffff !important;
        }

        body.dark-mode .search-box input {
            background: #1a1a1a !important;
            color: #ffffff !important;
        }

        body.dark-mode .search-box i {
            color: #0EA5E9 !important;
        }

        body.dark-mode .drop-zone {
            background: #1a1a1a !important;
            border-color: #0EA5E9 !important;
        }

        body.dark-mode .drop-zone i {
            color: #0EA5E9 !important;
        }

        body.dark-mode .confirm-content {
            background: #1a1a1a !important;
        }

        body.dark-mode .confirm-title {
            color: #ffffff !important;
        }

        body.dark-mode .confirm-message {
            color: #a0a0a0 !important;
        }

        body.dark-mode .admin-button-group button[style*="color:red"] {
            color: #ef4444 !important;
        }

        /* Mantener barras de color en modo oscuro */
        body.dark-mode .urgency-low {
            border-left: 4px solid #0EA5E9 !important;
        }

        body.dark-mode .doctor-urgency-low {
            border-left: 4px solid #10b981 !important;
        }

        body.dark-mode .urgency-medium {
            border-left: 4px solid #f59e0b !important;
        }

        body.dark-mode .urgency-high {
            border-left: 4px solid #ef4444 !important;
        }

        /* Sugerencia IA en modo oscuro */
        body.dark-mode .case-card div[style*="background: #f0f9ff"] {
            background: #1a3a52 !important;
        }

        body.dark-mode .case-card p[style*="color:#0369a1"],
        body.dark-mode .case-card p[style*="color:#1e40af"] {
            color: #60a5fa !important;
        }

        /* Botón eliminar en rojo */
        .delete-btn {
            background: #ef4444 !important;
            color: white !important;
        }

        .delete-btn:hover {
            background: #dc2626 !important;
        }

        body.dark-mode .delete-btn {
            background: #ef4444 !important;
            color: white !important;
        }

        /* LANDING PAGE EN MODO OSCURO */
        body.dark-mode .landing-navbar {
            background: rgba(0, 0, 0, 0.72) !important;
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .navbar-logo span {
            color: #ffffff !important;
        }

        body.dark-mode .navbar-links a {
            color: #ffffff !important;
        }

        body.dark-mode .btn-login {
            color: #ffffff !important;
        }

        body.dark-mode .hero-section {
            background: linear-gradient(to bottom, #000000, #0a0a0a) !important;
        }

        body.dark-mode .hero-title,
        body.dark-mode .hero-description,
        body.dark-mode .hero-feature,
        body.dark-mode .section-title,
        body.dark-mode .section-description {
            color: #ffffff !important;
        }

        body.dark-mode .hero-badge {
            background: #1a3a52 !important;
            color: #60a5fa !important;
        }

        body.dark-mode .features-section,
        body.dark-mode .testimonials-section,
        body.dark-mode .download-section {
            background: #000000 !important;
        }

        body.dark-mode .feature-card,
        body.dark-mode .testimonial-card,
        body.dark-mode .download-card {
            background: #0a0a0a !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }

        body.dark-mode .feature-title,
        body.dark-mode .feature-description,
        body.dark-mode .testimonial-text,
        body.dark-mode .testimonial-author,
        body.dark-mode .testimonial-role,
        body.dark-mode .download-platform,
        body.dark-mode .download-description {
            color: #ffffff !important;
        }

        body.dark-mode .feature-icon {
            background: #1a3a52 !important;
        }

        body.dark-mode .cta-section {
            background: linear-gradient(135deg, #0EA5E9, #0284c7) !important;
        }

        body.dark-mode .footer {
            background: #000000 !important;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .footer-brand h3,
        body.dark-mode .footer-section h4 {
            color: #ffffff !important;
        }

        body.dark-mode .footer-brand p,
        body.dark-mode .footer-links a,
        body.dark-mode .footer-copyright,
        body.dark-mode .footer-legal a {
            color: #a0a0a0 !important;
        }

        body.dark-mode .phone-frame {
            filter: drop-shadow(0 30px 80px rgba(14, 165, 233, 0.4));
        }

        /* NOTIFICACIONES TOAST */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10003;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease;
            min-width: 300px;
            backdrop-filter: blur(10px);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .toast-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .toast-info {
            background: linear-gradient(135deg, #0EA5E9, #0284c7);
        }

        .toast-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* LOADING SPINNER */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10004;
            backdrop-filter: blur(5px);
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: #0EA5E9;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner-text {
            color: white;
            margin-top: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        /* MODAL DE CONFIRMACIÓN */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10005;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .confirm-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: scaleIn 0.3s ease;
        }

        .confirm-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .confirm-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #1d1d1f;
        }

        .confirm-message {
            color: #64748B;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .confirm-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .confirm-actions button {
            width: auto;
            padding: 12px 30px;
            margin: 0;
        }

        /* DRAG & DROP ZONE */
        .drop-zone {
            border: 3px dashed #0EA5E9;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(14, 165, 233, 0.05);
        }

        .drop-zone.drag-over {
            background: rgba(14, 165, 233, 0.15);
            border-color: #0284c7;
            transform: scale(1.02);
        }

        .drop-zone i {
            font-size: 50px;
            color: #0EA5E9;
            margin-bottom: 15px;
        }

        /* CONTADOR DE CARACTERES */
        .char-counter {
            font-size: 12px;
            color: #64748B;
            text-align: right;
            margin-top: -10px;
            margin-bottom: 10px;
        }

        .char-counter.warning {
            color: #f59e0b;
        }

        .char-counter.danger {
            color: #ef4444;
        }

        /* VALIDACIÓN DE INPUTS */
        input.error, textarea.error, select.error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }

        input.success, textarea.success, select.success {
            border-color: #0EA5E9 !important;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1) !important;
        }

        .error-message {
            color: #ef4444;
            font-size: 13px;
            margin-top: -10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* BÚSQUEDA EN ADMIN */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            padding-left: 45px;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748B;
            font-size: 18px;
        }

        /* PWA INSTALL BUTTON */
        .install-pwa {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #0EA5E9, #0284c7);
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(14, 165, 233, 0.4);
            cursor: pointer;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 999;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        #logoLoader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        #logoLoader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-logo-container {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .loader-logo-container svg {
            width: 100%;
            height: 100%;
        }

        @keyframes sonarRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #sonarArc {
            animation: sonarRotate 3s linear infinite;
            transform-origin: 256px 256px;
        }

        .loader-text {
            margin-top: 30px;
            font-size: 28px;
            font-weight: 600;
            color: #1d1d1f;
            letter-spacing: -0.03em;
        }

        .loader-subtext {
            margin-top: 10px;
            font-size: 17px;
            color: #64748B;
            letter-spacing: -0.015em;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .animate-on-scroll {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .animate-scale {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .animate-scale.visible {
            opacity: 1;
            transform: scale(1);
        }

        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .landing-page { display: block; }
        .landing-page.hidden { display: none; }
        .hidden { display: none !important; }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(to bottom, var(--sk-secondary), #ffffff);
            padding: 140px 20px 100px;
            text-align: center;
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            align-items: center;
        }

        .hero-text { text-align: left; }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background: var(--sk-accent);
            border-radius: 100px;
            font-size: 13px;
            color: #0C4A6E;
            margin-bottom: 28px;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .hero-title {
            font-size: 64px;
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 24px;
            color: #1d1d1f;
            letter-spacing: -0.04em;
        }

        .hero-description {
            font-size: 21px;
            line-height: 1.5;
            color: #64748B;
            margin-bottom: 36px;
            font-weight: 400;
            letter-spacing: -0.015em;
        }

        .hero-buttons {
            display: flex;
            gap: 16px;
            margin-bottom: 48px;
        }

        .btn-primary {
            background: var(--sk-blue-light);
            color: white;
            padding: 17px 36px;
            border-radius: 980px;
            font-weight: 600;
            font-size: 17px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            letter-spacing: -0.02em;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(14, 165, 233, 0.35);
        }

        .btn-outline {
            background: white;
            color: var(--sk-blue-light);
            padding: 17px 36px;
            border-radius: 980px;
            font-weight: 600;
            font-size: 17px;
            border: 2px solid var(--sk-blue-light);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.02em;
        }

        .btn-outline:hover {
            background: var(--sk-secondary);
            transform: translateY(-2px);
        }

        .hero-features {
            display: flex;
            gap: 32px;
            flex-wrap: wrap;
        }

        .hero-feature {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748B;
            font-size: 15px;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .hero-image {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-phone-mockup {
            width: 100%;
            max-width: 400px;
            position: relative;
        }

        .phone-frame {
            width: 100%;
            height: auto;
            filter: drop-shadow(0 30px 80px rgba(0, 0, 0, 0.15));
        }

        /* CAMBIO 1: Logo en el móvil del hero */
        .phone-logo-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 75%;
            text-align: center;
            z-index: 10;
        }

        .phone-logo-display {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .phone-brand-text {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
            letter-spacing: -0.03em;
        }

        .phone-brand-tagline {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        /* Features Section */
        .features-section {
            padding: 120px 20px;
            background: white;
        }

        .section-header {
            text-align: center;
            max-width: 800px;
            margin: 0 auto 72px;
        }

        .section-title {
            font-size: 52px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1d1d1f;
            letter-spacing: -0.04em;
        }

        .section-description {
            font-size: 21px;
            color: #64748B;
            line-height: 1.5;
            font-weight: 400;
            letter-spacing: -0.015em;
        }

        .features-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 28px;
        }

        .feature-card {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 24px;
            padding: 44px;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .feature-card:hover {
            border-color: var(--sk-blue-light);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.08);
            transform: translateY(-6px);
        }

        .feature-icon {
            width: 56px;
            height: 56px;
            background: var(--sk-secondary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 28px;
        }

        .feature-icon i {
            font-size: 26px;
            color: var(--sk-blue-light);
        }

        .feature-title {
            font-size: 26px;
            font-weight: 600;
            margin-bottom: 14px;
            color: #1d1d1f;
            letter-spacing: -0.03em;
        }

        .feature-description {
            font-size: 17px;
            color: #64748B;
            line-height: 1.5;
            font-weight: 400;
            letter-spacing: -0.015em;
        }

        /* How It Works Section */
        .how-it-works-section {
            padding: 120px 20px;
            background: #000000;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .how-it-works-section .section-title,
        .how-it-works-section .section-description {
            color: white;
        }

        .phone-animation-container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            height: 800px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .animated-phone {
            position: relative;
            width: 320px;
            height: 650px;
            background: #1d1d1f;
            border-radius: 45px;
            padding: 12px;
            box-shadow: 0 40px 100px rgba(14, 165, 233, 0.3);
            border: 8px solid #2d2d2f;
        }

        .phone-notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 25px;
            background: #000;
            border-radius: 0 0 20px 20px;
            z-index: 10;
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0EA5E9, #38BDF8);
            border-radius: 35px;
            overflow: hidden;
            position: relative;
        }

        .step-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 30px;
        }

        .step-animation.active {
            opacity: 1;
        }

        .step-icon-large {
            font-size: 80px;
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
        }

        .step-text {
            text-align: center;
        }

        .step-text h3 {
            font-size: 32px;
            margin-bottom: 15px;
            color: white;
        }

        .step-text p {
            font-size: 17px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.85);
        }

        .steps-indicators {
            position: absolute;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 100px;
            margin-top: 60px;
        }

        .step-indicator {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 20px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            min-width: 180px;
        }

        .step-indicator:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .step-indicator.active {
            background: rgba(14, 165, 233, 0.2);
            border: 2px solid rgba(14, 165, 233, 0.5);
        }

        .step-number-indicator {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .step-indicator.active .step-number-indicator {
            background: var(--sk-blue-light);
            box-shadow: 0 0 30px rgba(14, 165, 233, 0.6);
        }

        .step-label {
            font-size: 15px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
        }

        .step-indicator.active .step-label {
            color: white;
        }

        /* Testimonials */
        .testimonials-section {
            padding: 120px 20px;
            background: white;
        }

        .testimonials-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 28px;
        }

        .testimonial-card {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 24px;
            padding: 44px;
            transition: all 0.4s ease;
        }

        .testimonial-card:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        }

        .stars {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
        }

        .stars i {
            color: var(--sk-blue-light);
            font-size: 18px;
        }

        .testimonial-text {
            font-size: 17px;
            color: #64748B;
            line-height: 1.6;
            margin-bottom: 28px;
            font-style: italic;
            letter-spacing: -0.015em;
        }

        .testimonial-author {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
            font-size: 17px;
            letter-spacing: -0.02em;
        }

        .testimonial-role {
            font-size: 15px;
            color: #64748B;
            letter-spacing: -0.01em;
        }

        /* Download Section */
        .download-section {
            padding: 120px 20px;
            background: white;
            text-align: center;
        }

        .download-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .download-options {
            display: flex;
            gap: 32px;
            justify-content: center;
            margin-top: 56px;
            flex-wrap: wrap;
        }

        .download-card {
            background: white;
            border: 2px solid rgba(0, 0, 0, 0.06);
            border-radius: 28px;
            padding: 52px 44px;
            flex: 1;
            min-width: 280px;
            max-width: 400px;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
        }

        .download-card:hover {
            border-color: var(--sk-blue-light);
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(14, 165, 233, 0.18);
        }

        .download-icon {
            font-size: 88px;
            margin-bottom: 28px;
            color: #64748B;
            transition: all 0.4s ease;
        }

        .download-card:hover .download-icon {
            color: var(--sk-blue-light);
            transform: scale(1.08);
        }

        .download-platform {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 14px;
            color: #1d1d1f;
            letter-spacing: -0.03em;
        }

        .download-description {
            font-size: 17px;
            color: #64748B;
            margin-bottom: 28px;
            line-height: 1.6;
            letter-spacing: -0.015em;
        }

        .download-btn {
            background: var(--sk-blue-light);
            color: white;
            padding: 16px 32px;
            border-radius: 980px;
            font-weight: 600;
            font-size: 17px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            letter-spacing: -0.02em;
        }

        .download-btn:hover {
            background: #0284c7;
            transform: scale(1.06);
        }

        /* CTA Section */
        .cta-section {
            background: linear-gradient(135deg, var(--sk-blue-light), #0284c7);
            color: white;
            padding: 120px 20px;
            text-align: center;
        }

        .cta-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .cta-icon {
            font-size: 72px;
            margin-bottom: 36px;
            opacity: 0.95;
        }

        .cta-title {
            font-size: 52px;
            font-weight: 700;
            margin-bottom: 28px;
            letter-spacing: -0.04em;
        }

        .cta-description {
            font-size: 21px;
            line-height: 1.5;
            margin-bottom: 44px;
            opacity: 0.95;
            letter-spacing: -0.015em;
        }

        .cta-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 28px;
        }

        .btn-white {
            background: white;
            color: var(--sk-blue-light);
            padding: 17px 36px;
            border-radius: 980px;
            font-weight: 600;
            font-size: 17px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            letter-spacing: -0.02em;
        }

        .btn-white:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .cta-note {
            font-size: 15px;
            opacity: 0.8;
            letter-spacing: -0.01em;
        }

        /* Footer */
        .footer {
            background: #f5f5f7;
            padding: 64px 40px 32px;
            font-size: 13px;
            color: #6e6e73;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-top {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 64px;
            margin-bottom: 48px;
            padding-bottom: 32px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .footer-brand h3 {
            font-size: 21px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .footer-brand p {
            line-height: 1.6;
            margin-bottom: 16px;
            color: #6e6e73;
            letter-spacing: -0.01em;
        }

        .footer-section h4 {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 16px;
            letter-spacing: -0.01em;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .footer-links a {
            color: #6e6e73;
            text-decoration: none;
            transition: color 0.3s ease;
            font-size: 13px;
            letter-spacing: -0.01em;
        }

        .footer-links a:hover {
            color: var(--sk-blue-light);
        }

        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 24px;
        }

        .footer-copyright {
            font-size: 12px;
            color: #86868b;
            letter-spacing: -0.01em;
        }

        .footer-legal {
            display: flex;
            gap: 24px;
        }

        .footer-legal a {
            font-size: 12px;
            color: #86868b;
            text-decoration: none;
            transition: color 0.3s ease;
            letter-spacing: -0.01em;
        }

        .footer-legal a:hover {
            color: var(--sk-blue-light);
        }

        /* Main Content */
        .main-content {
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            width: 100%;
        }

        .login-logo-inner {
            width: 150px;
            height: 150px;
            margin-bottom: 30px;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.08));
        }

        #loginPage h2 {
            font-size: 42px;
            margin-top: 0;
            margin-bottom: 12px;
        }

        #loginPage p {
            font-size: 15px;
            margin-bottom: 40px;
            color: #86868b;
        }

        .navbar-logo svg {
            width: 40px;
            height: 40px;
        }

        .brand-ia {
            font-size: 0.6em;
            vertical-align: top;
            margin-left: 2px;
            font-weight: 900;
            text-shadow: 0 0 12px rgba(0, 229, 255, 0.4);
            letter-spacing: 0.5px;
        }

        .brand-x {
            color: var(--sk-blue-light);
        }

        .container {
            max-width: 1200px;
            margin: 80px auto;
            padding: 20px;
        }

        input[type="text"],
        input[type="password"],
        input[type="file"],
        input[type="datetime-local"],
        textarea,
        select {
            width: 100%;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-family: inherit;
            font-size: 16px;
            background: #f5f5f7;
            transition: all 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            background: white;
            border-color: var(--sk-blue-light);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        button {
            width: 100%;
            padding: 16px;
            background: var(--sk-blue-light);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(14, 165, 233, 0.3);
        }

        .btn-secondary {
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .btn-secondary:hover {
            background: #e5e5ea;
        }

        .header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .role-badge {
            display: inline-block;
            padding: 6px 14px;
            background: var(--sk-accent);
            color: #0C4A6E;
            border-radius: 100px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 8px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            background: #f5f5f7;
            padding: 6px;
            border-radius: 12px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            color: #1d1d1f;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        .case-card {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .case-card:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .urgency-badge {
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 700;
        }

        .badge-high {
            background: #fee2e2;
            color: #991b1b;
            animation: pulseShadowHigh 2s ease-in-out infinite;
        }

        .badge-medium {
            background: #fef3c7;
            color: #92400e;
            animation: pulseShadowMedium 2s ease-in-out infinite;
        }

        .badge-low {
            background: #dcfce7;
            color: #15803d;
            animation: pulseShadowLow 2s ease-in-out infinite;
        }
        
        @keyframes pulseShadowHigh {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4);
            }
            50% {
                box-shadow: 0 4px 16px rgba(220, 38, 38, 0.7);
            }
        }
        
        @keyframes pulseShadowMedium {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
            }
            50% {
                box-shadow: 0 4px 16px rgba(245, 158, 11, 0.7);
            }
        }
        
        @keyframes pulseShadowLow {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(21, 128, 61, 0.3);
            }
            50% {
                box-shadow: 0 4px 16px rgba(21, 128, 61, 0.6);
            }
        }

        .urgency-high {
            border-left: 4px solid #dc2626;
        }

        .urgency-medium {
            border-left: 4px solid #f59e0b;
        }

        /* CAMBIO 4: Barra azul en historial de pacientes */
        .urgency-low {
            border-left: 4px solid #0EA5E9;
        }

        /* Barra verde para casos pendientes del doctor (urgencia baja) */
        .doctor-urgency-low {
            border-left: 4px solid #10b981;
        }

        .landing-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.72);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);
            z-index: 1000;
            padding: 18px 40px;
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 21px;
            font-weight: 600;
            color: #1d1d1f;
            letter-spacing: -0.02em;
        }

        .navbar-links {
            display: flex;
            gap: 36px;
            align-items: center;
        }

        .navbar-links a {
            color: #1d1d1f;
            text-decoration: none;
            font-weight: 500;
            font-size: 15px;
            transition: color 0.3s ease;
            letter-spacing: -0.01em;
        }

        .navbar-links a:hover {
            color: var(--sk-blue-light);
        }

        .btn-login {
            background: var(--sk-blue-light);
            color: white;
            padding: 10px 24px;
            border-radius: 980px;
            font-weight: 600;
            font-size: 15px;
            border: none;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            letter-spacing: -0.01em;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(14, 165, 233, 0.3);
        }

        /* CAMBIO 7: Modal con estilos correctos */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h3 {
            font-size: 28px;
            margin-bottom: 30px;
            text-align: center;
            color: #1d1d1f;
        }

        .modal-content input,
        .modal-content select,
        .modal-content textarea {
            width: 100%;
            padding: 14px;
            margin-bottom: 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-family: inherit;
            font-size: 16px;
            background: #f5f5f7;
        }

        .modal-content input:focus,
        .modal-content select:focus,
        .modal-content textarea:focus {
            outline: none;
            background: white;
            border-color: var(--sk-blue-light);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .modal-actions button {
            width: auto;
            padding: 12px 32px;
            margin: 0;
        }

        /* CAMBIO 3: Botones para cámara y eliminar foto */
        .upload-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .upload-controls button {
            width: auto;
            padding: 8px 16px;
            font-size: 13px;
        }

        .btn-camera {
            background: #0EA5E9;
        }

        .btn-camera:hover {
            background: #0284c7;
        }

        .btn-delete {
            background: #ef4444;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        /* CAMBIO 5: Modal para ver imagen completa */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            cursor: pointer;
        }

        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clickable-image {
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .clickable-image:hover {
            transform: scale(1.05);
        }

        /* CAMBIO 6: Espaciado entre botones de admin */
        .admin-button-group {
            display: flex;
            gap: 12px;
        }

        .admin-button-group button {
            width: auto;
            padding: 10px 20px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .hero-content,
            .features-grid,
            .testimonials-grid,
            .footer-top {
                grid-template-columns: 1fr;
            }

            .hero-title {
                font-size: 40px;
            }

            .section-title {
                font-size: 36px;
            }

            .cta-title {
                font-size: 36px;
            }

            .navbar-links a:not(.btn-login) {
                display: none;
            }

            .steps-indicators {
                flex-direction: column;
                gap: 20px;
            }
            
            .navbar-links .dark-mode-toggle {
                padding: 10px 16px !important;
                margin-left: 5px !important;
            }
            
            .navbar-links .dark-mode-toggle span {
                display: inline;
            }
        }
    </style>
</head>
<body>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- PWA Install Button -->
    <div class="install-pwa" id="installPWA">
        <i class="fa-solid fa-download"></i>
        <span data-i18n="install_app">Instalar App</span>
    </div>

    <div id="logoLoader">
        <div class="loader-logo-container">
            <svg fill="none" preserveAspectRatio="none" viewBox="0 0 512 512">
                <path d="M256 448C362.039 448 448 362.039 448 256C448 149.961 362.039 64 256 64C149.961 64 64 149.961 64 256C64 362.039 149.961 448 256 448Z" opacity="0.3" stroke="url(#paint0_linear)" stroke-width="25.6" />
                <path id="sonarArc" d="M256 64C306.922 64 355.758 84.2285 391.765 120.235C427.772 156.242 448 205.078 448 256" stroke="url(#paint1_linear)" stroke-linecap="round" stroke-width="34.1333" />
                <path d="M128 170.667V128H170.667" stroke="#0EA5E9" stroke-linecap="round" stroke-width="21.3333" />
                <path d="M384 170.667V128H341.333" stroke="#0EA5E9" stroke-linecap="round" stroke-width="21.3333" />
                <path d="M128 341.333V384H170.667" stroke="#38BDF8" stroke-linecap="round" stroke-width="21.3333" />
                <path d="M384 341.333V384H341.333" stroke="#38BDF8" stroke-linecap="round" stroke-width="21.3333" />
                <path d="M256 375.467C321.98 375.467 375.467 321.98 375.467 256C375.467 190.02 321.98 136.533 256 136.533C190.02 136.533 136.533 190.02 136.533 256C136.533 321.98 190.02 375.467 256 375.467Z" fill="url(#paint2_linear)" opacity="0.85" />
                <path d="M256 307.2C284.277 307.2 307.2 284.277 307.2 256C307.2 227.723 284.277 204.8 256 204.8C227.723 204.8 204.8 227.723 204.8 256C204.8 284.277 227.723 307.2 256 307.2Z" fill="white" />
                <path d="M256 290.133C274.851 290.133 290.133 274.851 290.133 256C290.133 237.149 274.851 221.867 256 221.867C237.149 221.867 221.867 237.149 221.867 256C221.867 274.851 237.149 290.133 256 290.133Z" fill="#0EA5E9" />
                <defs>
                    <linearGradient gradientUnits="userSpaceOnUse" id="paint0_linear" x1="64" x2="38464" y1="64" y2="38464">
                        <stop stop-color="#0EA5E9" />
                        <stop offset="1" stop-color="#38BDF8" />
                    </linearGradient>
                    <linearGradient gradientUnits="userSpaceOnUse" id="paint1_linear" x1="256" x2="19456" y1="64" y2="19264">
                        <stop stop-color="#0EA5E9" />
                        <stop offset="1" stop-color="#38BDF8" />
                    </linearGradient>
                    <linearGradient gradientUnits="userSpaceOnUse" id="paint2_linear" x1="136.533" x2="24029.9" y1="136.533" y2="24029.9">
                        <stop stop-color="#38BDF8" />
                        <stop offset="0.5" stop-color="#0EA5E9" />
                        <stop offset="1" stop-color="#1C3555" />
                    </linearGradient>
                </defs>
            </svg>
        </div>
        <div class="loader-text">Skin<span class="brand-x">X</span>pert</div>
        <div class="loader-subtext" data-i18n="loader_text">Cargando experiencia...</div>
    </div>

    <!-- LANDING PAGE -->
    <div id="landingPage" class="landing-page hidden">
        <nav class="landing-navbar">
            <div class="navbar-content">
                <div class="navbar-logo">
                    <svg fill="none" preserveAspectRatio="none" viewBox="0 0 512 512" width="40" height="40">
                        <g>
                            <path d="M256 448C362.039 448 448 362.039 448 256C448 149.961 362.039 64 256 64C149.961 64 64 149.961 64 256C64 362.039 149.961 448 256 448Z" opacity="0.3" stroke="url(#paint0_linear_nav)" stroke-width="25.6" />
                            <path d="M256 64C306.922 64 355.758 84.2285 391.765 120.235C427.772 156.242 448 205.078 448 256" stroke="url(#paint1_linear_nav)" stroke-linecap="round" stroke-width="34.1333" />
                            <path d="M256 375.467C321.98 375.467 375.467 321.98 375.467 256C375.467 190.02 321.98 136.533 256 136.533C190.02 136.533 136.533 190.02 136.533 256C136.533 321.98 190.02 375.467 256 375.467Z" fill="url(#paint2_linear_nav)" opacity="0.85" />
                            <path d="M256 307.2C284.277 307.2 307.2 284.277 307.2 256C307.2 227.723 284.277 204.8 256 204.8C227.723 204.8 204.8 227.723 204.8 256C204.8 284.277 227.723 307.2 256 307.2Z" fill="white" />
                            <path d="M256 290.133C274.851 290.133 290.133 274.851 290.133 256C290.133 237.149 274.851 221.867 256 221.867C237.149 221.867 221.867 237.149 221.867 256C221.867 274.851 237.149 290.133 256 290.133Z" fill="#0EA5E9" />
                            <path d="M128 170.667V128H170.667" stroke="#0EA5E9" stroke-linecap="round" stroke-width="21.3333" />
                            <path d="M384 170.667V128H341.333" stroke="#0EA5E9" stroke-linecap="round" stroke-width="21.3333" />
                            <path d="M128 341.333V384H170.667" stroke="#38BDF8" stroke-linecap="round" stroke-width="21.3333" />
                            <path d="M384 341.333V384H341.333" stroke="#38BDF8" stroke-linecap="round" stroke-width="21.3333" />
                        </g>
                        <defs>
                            <linearGradient gradientUnits="userSpaceOnUse" id="paint0_linear_nav" x1="64" x2="38464" y1="64" y2="38464">
                                <stop stop-color="#0EA5E9" />
                                <stop offset="1" stop-color="#38BDF8" />
                            </linearGradient>
                            <linearGradient gradientUnits="userSpaceOnUse" id="paint1_linear_nav" x1="256" x2="19456" y1="64" y2="19264">
                                <stop stop-color="#0EA5E9" />
                                <stop offset="1" stop-color="#38BDF8" />
                            </linearGradient>
                            <linearGradient gradientUnits="userSpaceOnUse" id="paint2_linear_nav" x1="136.533" x2="24029.9" y1="136.533" y2="24029.9">
                                <stop stop-color="#38BDF8" />
                                <stop offset="0.5" stop-color="#0EA5E9" />
                                <stop offset="1" stop-color="#1C3555" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <span>Skin<span class="brand-x">X</span>pert</span>
                </div>
                <div class="navbar-links">
                    <a href="#inicio" data-i18n="nav_home">Inicio</a>
                    <a href="#caracteristicas" data-i18n="nav_features">Características</a>
                    <a href="#como-funciona" data-i18n="nav_how">Cómo Funciona</a>
                    <a href="#descargar" data-i18n="nav_download">Descargar</a>
                    <button class="btn-login" onclick="showLogin()" data-i18n="nav_login">Iniciar Sesión</button>
                    <button class="dark-mode-toggle" onclick="toggleLanguage()" style="width: auto; padding: 10px 20px; margin-left: 10px;">
                        <i class="fa-solid fa-language"></i>
                        <span id="langToggleText">EN</span>
                    </button>
                </div>
            </div>
        </nav>

        <section id="inicio" class="hero-section">
            <div class="hero-content">
                <div class="hero-text">
                    <div class="hero-badge animate-on-scroll">
                        <i class="fa-solid fa-check-circle"></i>
                        Tecnología médica avanzada
                    </div>
                    <h1 class="hero-title animate-on-scroll">Detección Temprana de Problemas de la Piel al Alcance de tu Mano</h1>
                    <p class="hero-description animate-on-scroll">
                        SkinXpert utiliza inteligencia artificial avanzada para detectar cánceres de piel y otros problemas dermatológicos.
                        Nuestra IA analiza, prioriza por urgencia y conecta pacientes con especialistas para diagnósticos precisos.
                    </p>
                    <div class="hero-buttons animate-on-scroll">
                        <button class="btn-primary" onclick="showLogin()">
                            Comenzar Ahora
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                        <button class="btn-outline" onclick="document.getElementById('descargar').scrollIntoView({behavior: 'smooth'})">
                            Descargar App
                            <i class="fa-solid fa-download"></i>
                        </button>
                    </div>
                    <div class="hero-features animate-on-scroll">
                        <div class="hero-feature">
                            <i class="fa-solid fa-check-circle" style="color: var(--sk-blue-light);"></i>
                            Análisis en segundos
                        </div>
                        <div class="hero-feature">
                            <i class="fa-solid fa-check-circle" style="color: var(--sk-blue-light);"></i>
                            Privacidad garantizada
                        </div>
                        <div class="hero-feature">
                            <i class="fa-solid fa-check-circle" style="color: var(--sk-blue-light);"></i>
                            Fácil de usar
                        </div>
                    </div>
                </div>
                <div class="hero-image animate-scale">
                    <div class="hero-phone-mockup">
                        <svg class="phone-frame" viewBox="0 0 300 600" fill="none">
                            <rect x="10" y="10" width="280" height="580" rx="40" fill="#1d1d1f" />
                            <rect x="20" y="20" width="260" height="560" rx="35" fill="url(#screenGradient)" />
                            <rect x="100" y="20" width="100" height="25" rx="12" fill="#000" />
                            <defs>
                                <linearGradient id="screenGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#0EA5E9;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#38BDF8;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                        </svg>

                        <!-- CAMBIO 1: Logo en lugar de login -->
                        <div class="phone-logo-content">
                            <svg class="phone-logo-display" fill="none" viewBox="0 0 512 512">
                                <path d="M256 448C362.039 448 448 362.039 448 256C448 149.961 362.039 64 256 64C149.961 64 64 149.961 64 256C64 362.039 149.961 448 256 448Z" opacity="0.3" stroke="url(#paint0_hero_phone)" stroke-width="25.6" />
                                <path d="M256 64C306.922 64 355.758 84.2285 391.765 120.235C427.772 156.242 448 205.078 448 256" stroke="url(#paint1_hero_phone)" stroke-linecap="round" stroke-width="34.1333" />
                                <path d="M256 375.467C321.98 375.467 375.467 321.98 375.467 256C375.467 190.02 321.98 136.533 256 136.533C190.02 136.533 136.533 190.02 136.533 256C136.533 321.98 190.02 375.467 256 375.467Z" fill="url(#paint2_hero_phone)" opacity="0.85" />
                                <path d="M256 307.2C284.277 307.2 307.2 284.277 307.2 256C307.2 227.723 284.277 204.8 256 204.8C227.723 204.8 204.8 227.723 204.8 256C204.8 284.277 227.723 307.2 256 307.2Z" fill="white" />
                                <path d="M256 290.133C274.851 290.133 290.133 274.851 290.133 256C290.133 237.149 274.851 221.867 256 221.867C237.149 221.867 221.867 237.149 221.867 256C221.867 274.851 237.149 290.133 256 290.133Z" fill="#fff" />
                                <path d="M128 170.667V128H170.667" stroke="#fff" stroke-linecap="round" stroke-width="21.3333" />
                                <path d="M384 170.667V128H341.333" stroke="#fff" stroke-linecap="round" stroke-width="21.3333" />
                                <path d="M128 341.333V384H170.667" stroke="rgba(255,255,255,0.8)" stroke-linecap="round" stroke-width="21.3333" />
                                <path d="M384 341.333V384H341.333" stroke="rgba(255,255,255,0.8)" stroke-linecap="round" stroke-width="21.3333" />
                                <defs>
                                    <linearGradient id="paint0_hero_phone" x1="64" x2="38464" y1="64" y2="38464">
                                        <stop stop-color="#fff" />
                                        <stop offset="1" stop-color="rgba(255,255,255,0.5)" />
                                    </linearGradient>
                                    <linearGradient id="paint1_hero_phone" x1="256" x2="19456" y1="64" y2="19264">
                                        <stop stop-color="#fff" />
                                        <stop offset="1" stop-color="rgba(255,255,255,0.7)" />
                                    </linearGradient>
                                    <linearGradient id="paint2_hero_phone" x1="136.533" x2="375.467" y1="136.533" y2="375.467">
                                        <stop stop-color="#fff" />
                                        <stop offset="1" stop-color="rgba(255,255,255,0.8)" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <h3 class="phone-brand-text">Skin<span class="brand-x">X</span>pert</h3>
                            <p class="phone-brand-tagline">Detección inteligente de<br>enfermedades de piel</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="caracteristicas" class="features-section">
            <div class="section-header">
                <h2 class="section-title animate-on-scroll">Características Principales</h2>
                <p class="section-description animate-on-scroll">
                    Tecnología médica de vanguardia diseñada para cuidar de tu piel con la mayor precisión y facilidad.
                </p>
            </div>
            <div class="features-grid">
                <div class="feature-card animate-on-scroll">
                    <div class="feature-icon">
                        <i class="fa-solid fa-brain"></i>
                    </div>
                    <h3 class="feature-title">IA Avanzada</h3>
                    <p class="feature-description">
                        Algoritmos de aprendizaje profundo especializados en detectar cánceres de piel y enfermedades dermatológicas.
                    </p>
                </div>
                <div class="feature-card animate-on-scroll">
                    <div class="feature-icon">
                        <i class="fa-solid fa-camera"></i>
                    </div>
                    <h3 class="feature-title">Análisis con IA y Revisión Médica</h3>
                    <p class="feature-description">
                        Captura una foto de tu piel. La IA analiza y detecta posibles problemas, asignando un nivel de urgencia.
                    </p>
                </div>
                <div class="feature-card animate-on-scroll">
                    <div class="feature-icon">
                        <i class="fa-solid fa-lock"></i>
                    </div>
                    <h3 class="feature-title">100% Privado</h3>
                    <p class="feature-description">
                        Tus datos de salud están encriptados y nunca son compartidos. Tu privacidad es nuestra prioridad.
                    </p>
                </div>
                <div class="feature-card animate-on-scroll">
                    <div class="feature-icon">
                        <i class="fa-solid fa-file-medical"></i>
                    </div>
                    <h3 class="feature-title">Historial Completo</h3>
                    <p class="feature-description">
                        Guarda y compara análisis a lo largo del tiempo para monitorear cambios en tu piel.
                    </p>
                </div>
                <div class="feature-card animate-on-scroll">
                    <div class="feature-icon">
                        <i class="fa-solid fa-bolt"></i>
                    </div>
                    <h3 class="feature-title">Alertas Inteligentes</h3>
                    <p class="feature-description">
                        Recibe notificaciones si detectamos cambios significativos que requieran atención médica.
                    </p>
                </div>
                <div class="feature-card animate-on-scroll">
                    <div class="feature-icon">
                        <i class="fa-solid fa-heart-pulse"></i>
                    </div>
                    <h3 class="feature-title">Prevención Proactiva</h3>
                    <p class="feature-description">
                        Detecta problemas tempranos cuando son más tratables. Tu salud es lo primero.
                    </p>
                </div>
            </div>
        </section>

        <!-- CAMBIO 2: Iconos agregados a Análisis y Resultados -->
        <section id="como-funciona" class="how-it-works-section">
            <div class="section-header">
                <h2 class="section-title animate-on-scroll">Cómo Funciona</h2>
                <p class="section-description animate-on-scroll">
                    En solo 3 simples pasos, puedes obtener un análisis profesional de tu piel.
                </p>
            </div>

            <div class="phone-animation-container">
                <div class="animated-phone">
                    <div class="phone-notch"></div>
                    <div class="phone-screen">
                        <div class="step-animation active" id="step1">
                            <div class="step-icon-large">
                                <i class="fa-solid fa-camera" style="font-size: 120px;"></i>
                            </div>
                            <div class="step-text">
                                <h3>Captura</h3>
                                <p>Toma una foto clara de la zona de piel que deseas analizar usando tu smartphone</p>
                            </div>
                        </div>

                        <div class="step-animation" id="step2">
                            <div class="step-icon-large">
                                <i class="fa-solid fa-chart-line" style="font-size: 120px;"></i>
                            </div>
                            <div class="step-text">
                                <h3>Análisis</h3>
                                <p>Nuestra IA analiza la imagen en segundos, comparándola con miles de casos dermatológicos</p>
                            </div>
                        </div>

                        <div class="step-animation" id="step3">
                            <div class="step-icon-large">
                                <i class="fa-solid fa-clipboard-check" style="font-size: 120px;"></i>
                            </div>
                            <div class="step-text">
                                <h3>Resultados</h3>
                                <p>Recibe un informe detallado con recomendaciones y si es necesario, consultar a un especialista</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="steps-indicators">
                    <div class="step-indicator active" onclick="changeStep(1)">
                        <div class="step-number-indicator">01</div>
                        <div class="step-label">Captura</div>
                    </div>
                    <div class="step-indicator" onclick="changeStep(2)">
                        <div class="step-number-indicator">02</div>
                        <div class="step-label">Análisis</div>
                    </div>
                    <div class="step-indicator" onclick="changeStep(3)">
                        <div class="step-number-indicator">03</div>
                        <div class="step-label">Resultados</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="testimonios" class="testimonials-section">
            <div class="section-header">
                <h2 class="section-title animate-on-scroll">Lo Que Dicen Nuestros Usuarios</h2>
                <p class="section-description animate-on-scroll">
                    Miles de personas confían en SkinXpert para cuidar de su salud dermatológica.
                </p>
            </div>
            <div class="testimonials-grid">
                <div class="testimonial-card animate-on-scroll">
                    <div class="stars">
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                    </div>
                    <p class="testimonial-text">
                        "Esta app me ayudó a detectar un lunar sospechoso que luego fue confirmado por mi dermatólogo. La detección temprana hizo toda la diferencia."
                    </p>
                    <div class="testimonial-author">María González</div>
                    <div class="testimonial-role">Usuario SkinXpert</div>
                </div>
                <div class="testimonial-card animate-on-scroll">
                    <div class="stars">
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                    </div>
                    <p class="testimonial-text">
                        "Muy fácil de usar y rápida. Me da tranquilidad poder monitorear mi piel regularmente sin tener que esperar citas médicas."
                    </p>
                    <div class="testimonial-author">Carlos Ruiz</div>
                    <div class="testimonial-role">Usuario SkinXpert</div>
                </div>
                <div class="testimonial-card animate-on-scroll">
                    <div class="stars">
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                    </div>
                    <p class="testimonial-text">
                        "La interfaz es intuitiva y los resultados son claros. Excelente herramienta para el cuidado preventivo de la piel."
                    </p>
                    <div class="testimonial-author">Ana Martínez</div>
                    <div class="testimonial-role">Usuario SkinXpert</div>
                </div>
            </div>
        </section>

        <section id="descargar" class="download-section">
            <div class="download-content">
                <div class="section-header">
                    <h2 class="section-title animate-on-scroll">Descarga SkinXpert</h2>
                    <p class="section-description animate-on-scroll">
                        Disponible para iOS y Android. Comienza a cuidar tu salud dermatológica hoy mismo.
                    </p>
                </div>

                <div class="download-options">
                    <div class="download-card animate-on-scroll">
                        <div class="download-icon">
                            <i class="fa-brands fa-apple"></i>
                        </div>
                        <h3 class="download-platform">iOS</h3>
                        <p class="download-description">
                            Compatible con iPhone y iPad.<br>
                            Requiere iOS 14.0 o superior.
                        </p>
                        <button class="download-btn">
                            <i class="fa-solid fa-download"></i>
                            Descargar en App Store
                        </button>
                    </div>

                    <div class="download-card animate-on-scroll">
                        <div class="download-icon">
                            <i class="fa-brands fa-android"></i>
                        </div>
                        <h3 class="download-platform">Android</h3>
                        <p class="download-description">
                            Compatible con dispositivos Android.<br>
                            Requiere Android 8.0 o superior.
                        </p>
                        <button class="download-btn">
                            <i class="fa-solid fa-download"></i>
                            Descargar en Google Play
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="cta-section">
            <div class="cta-content">
                <div class="cta-icon animate-on-scroll">
                    <i class="fa-solid fa-shield-heart"></i>
                </div>
                <h2 class="cta-title animate-on-scroll">Protege tu Piel Hoy</h2>
                <p class="cta-description animate-on-scroll">
                    La detección temprana puede salvar vidas. Descarga SkinXpert y comienza a cuidar de tu salud dermatológica con la confianza de la tecnología médica avanzada.
                </p>
                <div class="cta-buttons">
                    <button class="btn-white animate-on-scroll" onclick="showLogin()">
                        <i class="fa-solid fa-right-to-bracket"></i>
                        Acceder a la Plataforma
                    </button>
                </div>
                <p class="cta-note animate-on-scroll">
                    Sistema disponible para médicos y pacientes
                </p>
            </div>
        </section>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-top">
                    <div class="footer-brand">
                        <h3>SkinXpert</h3>
                        <p>Tecnología médica avanzada para la detección temprana de problemas de piel. Tu salud dermatológica es nuestra prioridad.</p>
                    </div>
                    <div class="footer-section">
                        <h4>Enlaces</h4>
                        <div class="footer-links">
                            <a href="#sobre-nosotros">Sobre Nosotros</a>
                            <a href="#privacidad">Privacidad</a>
                            <a href="#terminos">Términos de Uso</a>
                            <a href="#soporte">Soporte</a>
                        </div>
                    </div>
                    <div class="footer-section">
                        <h4>Contacto</h4>
                        <div class="footer-links">
                            <a href="mailto:contacto@skinxpert.com">contacto@skinxpert.com</a>
                            <a href="#">Av. Salud Digital 123</a>
                            <a href="#">Ciudad, País</a>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div class="footer-copyright">
                        © 2025 SkinXpert. Todos los derechos reservados.
                    </div>
                    <div class="footer-legal">
                        <a href="#privacidad">Privacidad</a>
                        <a href="#terminos">Términos</a>
                        <a href="#cookies">Cookies</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <div class="main-content">
        <div id="loginPage" class="container hidden" style="max-width: 450px; text-align: center;">
            <div style="text-align: center;">
                <svg class="login-logo-inner" fill="none" preserveAspectRatio="none" viewBox="0 0 512 512">
                    <g>
                        <path d="M256 448C362.039 448 448 362.039 448 256C448 149.961 362.039 64 256 64C149.961 64 64 149.961 64 256C64 362.039 149.961 448 256 448Z" opacity="0.3" stroke="url(#paint0_linear_login)" stroke-width="25.6" />
                        <path d="M256 64C306.922 64 355.758 84.2285 391.765 120.235C427.772 156.242 448 205.078 448 256" stroke="url(#paint1_linear_login)" stroke-linecap="round" stroke-width="34.1333" />
                        <path d="M256 375.467C321.98 375.467 375.467 321.98 375.467 256C375.467 190.02 321.98 136.533 256 136.533C190.02 136.533 136.533 190.02 136.533 256C136.533 321.98 190.02 375.467 256 375.467Z" fill="url(#paint2_linear_login)" opacity="0.85" />
                        <path d="M256 307.2C284.277 307.2 307.2 284.277 307.2 256C307.2 227.723 284.277 204.8 256 204.8C227.723 204.8 204.8 227.723 204.8 256C204.8 284.277 227.723 307.2 256 307.2Z" fill="white" />
                        <path d="M256 290.133C274.851 290.133 290.133 274.851 290.133 256C290.133 237.149 274.851 221.867 256 221.867C237.149 221.867 221.867 237.149 221.867 256C221.867 274.851 237.149 290.133 256 290.133Z" fill="#0EA5E9" />
                        <path d="M128 170.667V128H170.667" stroke="#0EA5E9" stroke-linecap="round" stroke-width="21.3333" />
                        <path d="M384 170.667V128H341.333" stroke="#0EA5E9" stroke-linecap="round" stroke-width="21.3333" />
                        <path d="M128 341.333V384H170.667" stroke="#38BDF8" stroke-linecap="round" stroke-width="21.3333" />
                        <path d="M384 341.333V384H341.333" stroke="#38BDF8" stroke-linecap="round" stroke-width="21.3333" />
                    </g>
                    <defs>
                        <linearGradient gradientUnits="userSpaceOnUse" id="paint0_linear_login" x1="64" x2="38464" y1="64" y2="38464">
                            <stop stop-color="#0EA5E9" />
                            <stop offset="1" stop-color="#38BDF8" />
                        </linearGradient>
                        <linearGradient gradientUnits="userSpaceOnUse" id="paint1_linear_login" x1="256" x2="19456" y1="64" y2="19264">
                            <stop stop-color="#0EA5E9" />
                            <stop offset="1" stop-color="#38BDF8" />
                        </linearGradient>
                        <linearGradient gradientUnits="userSpaceOnUse" id="paint2_linear_login" x1="136.533" x2="24029.9" y1="136.533" y2="24029.9">
                            <stop stop-color="#38BDF8" />
                            <stop offset="0.5" stop-color="#0EA5E9" />
                            <stop offset="1" stop-color="#1C3555" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>

            <h2>Skin<span class="brand-x">X</span>pert</h2>
            <p data-i18n="login_subtitle">Iniciar sesión para continuar</p>

            <input id="email" type="text" placeholder="Correo electrónico o cédula">
            <div class="error-message" id="emailError" style="display:none;">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span></span>
            </div>

            <input id="password" type="password" placeholder="Contraseña">
            <div class="error-message" id="passwordError" style="display:none;">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span></span>
            </div>

            <button onclick="handleLogin()" id="loginBtn" data-i18n="login_btn">Iniciar Sesión</button>

            <div style="margin-top: 20px;">
                <button onclick="showLanding()" class="btn-secondary" style="width: 100%;">
                    <i class="fa-solid fa-arrow-left"></i> <span data-i18n="login_back">Volver al inicio</span>
                </button>
            </div>
        </div>

        <!-- CAMBIO 3: Nueva consulta con botones de cámara y eliminar -->
        <div id="patientDashboard" class="container hidden">
            <div class="header-flex">
                <div>
                    <h2 style="font-size: 32px;">Hello, <span id="p_name">Patient</span></h2>
                    <span class="role-badge">Patient</span>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                        <i class="fa-solid fa-moon" id="darkModeIcon"></i>
                        <span id="darkModeText">Dark Mode</span>
                    </button>
                    <button class="btn-secondary" style="width: auto; margin:0;" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="tabs reveal-on-scroll">
                <button class="tab-btn active" onclick="openTab('p-consult', this)">Consultation</button>
                <button class="tab-btn" onclick="openTab('p-citas', this)">Appointments</button>
                <button class="tab-btn" onclick="openTab('p-historial', this)">History</button>
                <button class="tab-btn" onclick="openTab('p-minixpert', this)">Mini-Xpert</button>
            </div>

            <div id="p-consult" class="tab-content active">
                <div class="case-card reveal-on-scroll" style="text-align: center; padding: 40px 30px; max-width: 650px; margin: 0 auto;">
                    <i class="fa-solid fa-camera" style="font-size: 50px; color: #d2d2d7; margin-bottom: 20px;"></i>
                    <h3>New Consultation</h3>
                    <p>Upload a photo of your lesion for your doctor to evaluate</p>
                    
                    <img id="imagePreview" style="
                        display:none;
                        margin:20px auto;
                        max-width:100%;
                        max-height:400px;
                        border-radius:12px;
                        box-shadow:0 10px 25px rgba(0,0,0,0.15);
                    " />

                    <div class="upload-controls">
                        <button class="btn-camera" onclick="document.getElementById('uploadImage').click()">
                            <i class="fa-solid fa-folder-open"></i> Select File
                        </button>
                        <button class="btn-camera" onclick="captureFromCamera()">
                            <i class="fa-solid fa-camera"></i> Use Camera
                        </button>
                        <button class="btn-delete" id="deletePhotoBtn" style="display:none;" onclick="deleteSelectedPhoto()">
                            <i class="fa-solid fa-trash"></i> Delete Photo
                        </button>
                    </div>

                    <input type="file" id="uploadImage" accept="image/*" onchange="previewImage(event)" style="display:none;">
                    
                    <button id="uploadBtn" style="margin-top:20px;" onclick="uploadCase()">Send Consultation</button>
                </div>
            </div>

            <div id="p-citas" class="tab-content">
                <div id="patientAppointmentsList"></div>
            </div>

            <div id="p-historial" class="tab-content">
                <div id="patientHistoryList"></div>
            </div>

            <div id="p-minixpert" class="tab-content">
                <div class="case-card reveal-on-scroll" style="text-align: center; padding: 40px;">
                    <i class="fa-solid fa-microphone-lines" style="font-size: 60px; color: #0EA5E9; margin-bottom: 20px;"></i>
                    <h3>Mini<span class="brand-x">X</span>pert Voice Assistant</h3>
                    <p style="color: #888; margin-bottom: 30px;">Listen to your medical information in audio format</p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn-secondary" onclick="readHistory()" style="padding: 14px 28px; font-size: 15px;">
                            <i class="fa-solid fa-volume-high"></i> Read History
                        </button>
                        <button class="btn-secondary" onclick="readAppointments()" style="padding: 14px 28px; font-size: 15px;">
                            <i class="fa-solid fa-calendar-check"></i> Read Appointments
                        </button>
                        <button class="btn-delete" id="stopSpeechBtn" onclick="stopSpeech()" style="display: none; padding: 14px 28px; font-size: 15px;">
                            <i class="fa-solid fa-stop"></i> Stop
                        </button>
                    </div>

                    <div id="speechStatus" style="margin-top: 25px; padding: 15px; background: #f5f5f7; border-radius: 12px; display: none;">
                        <i class="fa-solid fa-circle-notch fa-spin" style="color: #0EA5E9; margin-right: 8px;"></i>
                        <span id="speechStatusText">Reading...</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="doctorDashboard" class="container hidden" style="max-width: 900px;">
            <div class="header-flex">
                <div>
                    <h2 style="font-size: 32px;"><span id="d_name">Médico</span></h2>
                    <span class="role-badge">Dermatología</span>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                        <i class="fa-solid fa-moon" id="darkModeIconDoctor"></i>
                        <span id="darkModeTextDoctor">Modo Oscuro</span>
                    </button>
                    <button class="btn-secondary" style="width: auto; margin:0;" onclick="logout()">Salir</button>
                </div>
            </div>

            <div class="tabs reveal-on-scroll">
                <button class="tab-btn active" onclick="openTab('d-pending', this)">Pendientes</button>
                <button class="tab-btn" onclick="openTab('d-patients', this)">Pacientes</button>
                <button class="tab-btn" onclick="openTab('d-citas', this)">Agenda</button>
                <button class="tab-btn" onclick="openTab('d-camera', this)">Cámara</button>
            </div>

            <div id="d-pending" class="tab-content active">
                <p class="reveal-on-scroll" style="font-size:14px; color:var(--text-secondary); margin-bottom:20px;">
                    <i class="fa-solid fa-arrow-down-short-wide"></i> Ordenado por Urgencia (IA)
                </p>
                <div id="doctorPendingList"></div>
            </div>

            <div id="d-patients" class="tab-content">
                <div class="search-box">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="patientSearch" placeholder="Buscar paciente..." oninput="filterPatients(this.value)">
                </div>
                <div id="doctorPatientsList"></div>
            </div>

            <div id="d-citas" class="tab-content">
                <div id="doctorAppointmentsList"></div>
            </div>

            <div id="d-camera" class="tab-content">
                <div class="case-card reveal-on-scroll" style="background:#000; color:white; text-align:center;">
                    <h3 style="color:white; margin-bottom:10px;">Visor Dermatoscopio</h3>
                    <video id="camera-preview" autoplay playsinline style="width:100%; border-radius:12px; background:#333; display:none;"></video>
                    <div style="padding-top:20px;">
                        <button id="btnCamera" class="btn-secondary" onclick="toggleCamera()" style="background:white !important; color:black !important; width:auto;">
                            <i class="fa-solid fa-camera"></i> Iniciar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CAMBIO 6: Espaciado entre botones de admin -->
        <div id="adminDashboard" class="container hidden" style="max-width:1000px;">
            <div class="header-flex">
                <h2>Panel Admin</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                        <i class="fa-solid fa-moon" id="darkModeIconAdmin"></i>
                        <span id="darkModeTextAdmin">Modo Oscuro</span>
                    </button>
                    <button class="btn-secondary" style="width: auto; margin:0;" onclick="logout()">Salir</button>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="openTab('admin-doctors', this)">Doctores</button>
                <button class="tab-btn" onclick="openTab('admin-patients', this)">Pacientes</button>
            </div>

            <div id="admin-doctors" class="tab-content active">
                <div class="search-box">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="doctorSearch" placeholder="Buscar doctor..." oninput="filterDoctors(this.value)">
                </div>
                <div id="adminDoctorsList"></div>
                <button class="btn-primary" onclick="openNewDoctor(); scrollToBottom();" style="margin-top: 20px;">
                    <i class="fa-solid fa-plus"></i> Nuevo Doctor
                </button>
            </div>

            <div id="admin-patients" class="tab-content">
                <div class="search-box">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="adminPatientSearch" placeholder="Buscar paciente..." oninput="filterAdminPatients(this.value)">
                </div>
                <div id="adminPatientsList"></div>
                <button class="btn-primary" onclick="openNewPatient(); scrollToBottom();" style="margin-top: 20px;">
                    <i class="fa-solid fa-plus"></i> Nuevo Paciente
                </button>
            </div>
        </div>
    </div>

    <!-- CAMBIO 5: Modal para ver imagen completa -->
    <div id="imageModal" class="image-modal hidden" onclick="closeImageModal()">
        <span class="image-modal-close">×</span>
        <img id="modalImage" src="" alt="Imagen completa">
    </div>

    <!-- CAMBIO 7: Modal corregido con estilos -->
    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <div id="modal-body"></div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal()" data-i18n="cancel">Cancelar</button>
                <button class="btn-primary" id="modalSaveBtn" onclick="modalSave()" data-i18n="save">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        const API = "http://localhost:1880";
        let currentView = 'landing';
        let currentStep = 1;
        let deferredPrompt;
        
        // CACHÉ localStorage
        const cache = {
            set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
            get: (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key));
                } catch { return null; }
            },
            remove: (key) => localStorage.removeItem(key)
        };

        // SISTEMA DE NOTIFICACIONES TOAST
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = {
                success: 'fa-circle-check',
                error: 'fa-circle-xmark',
                info: 'fa-circle-info',
                warning: 'fa-triangle-exclamation'
            };
            
            toast.innerHTML = `
                <i class="fa-solid ${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(400px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // LOADING SPINNER
        function showLoading(text) {
            // Si no se proporciona texto, usar la traducción
            if (!text) {
                text = translations[currentLang].processing;
            }
            
            const existing = document.getElementById('loadingSpinner');
            if (existing) return;
            
            const overlay = document.createElement('div');
            overlay.id = 'loadingSpinner';
            overlay.className = 'spinner-overlay';
            overlay.innerHTML = `
                <div class="spinner"></div>
                <div class="spinner-text">${text}</div>
            `;
            document.body.appendChild(overlay);
        }

        function hideLoading() {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) spinner.remove();
        }

        // FUNCIÓN PARA TRADUCIR ESTADOS
        function translateStatus(status) {
            if (!status) return status;
            const statusLower = status.toLowerCase().trim();
            
            // Mapeo de estados en español a las claves de traducción
            const statusMap = {
                'pendiente': 'status_pending',
                'completado': 'status_completed',
                'cancelado': 'status_cancelled',
                'pending': 'status_pending',
                'completed': 'status_completed',
                'cancelled': 'status_cancelled'
            };
            
            const translationKey = statusMap[statusLower];
            if (translationKey && translations[currentLang]) {
                return translations[currentLang][translationKey];
            }
            
            // Si no hay traducción, devolver el valor original
            return status;
        }

        // MODAL DE CONFIRMACIÓN PERSONALIZADO
        function showConfirm(title, message, icon = '⚠️', onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'confirm-modal';
            modal.innerHTML = `
                <div class="confirm-content">
                    <div class="confirm-icon">${icon}</div>
                    <h3 class="confirm-title">${title}</h3>
                    <p class="confirm-message">${message}</p>
                    <div class="confirm-actions">
                        <button class="btn-secondary" onclick="this.closest('.confirm-modal').remove()">
                            ${translations[currentLang].cancel}
                        </button>
                        <button class="btn-primary" id="confirmBtn" style="background: #ef4444;">
                            ${translations[currentLang].confirm}
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('confirmBtn').onclick = () => {
                onConfirm();
                modal.remove();
            };
        }

        // VALIDACIÓN DE INPUTS
        function validateInput(input, rules) {
            const value = input.value.trim();
            const errorDiv = document.getElementById(input.id + 'Error');
            
            if (rules.required && !value) {
                input.classList.add('error');
                input.classList.remove('success');
                if (errorDiv) {
                    errorDiv.style.display = 'flex';
                    errorDiv.querySelector('span').textContent = translations[currentLang].required_field;
                }
                return false;
            }
            
            if (rules.email && value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                input.classList.add('error');
                input.classList.remove('success');
                if (errorDiv) {
                    errorDiv.style.display = 'flex';
                    errorDiv.querySelector('span').textContent = translations[currentLang].invalid_email;
                }
                return false;
            }
            
            if (rules.minLength && value.length < rules.minLength) {
                input.classList.add('error');
                input.classList.remove('success');
                if (errorDiv) {
                    errorDiv.style.display = 'flex';
                    errorDiv.querySelector('span').textContent = translations[currentLang].min_length.replace('{n}', rules.minLength);
                }
                return false;
            }
            
            input.classList.remove('error');
            input.classList.add('success');
            if (errorDiv) errorDiv.style.display = 'none';
            return true;
        }

        // CONTADOR DE CARACTERES
        function updateCharCount(textarea) {
            const maxLength = textarea.getAttribute('maxlength') || 500;
            const current = textarea.value.length;
            const counterId = textarea.id + '-count';
            let counter = document.getElementById(counterId);
            
            if (!counter) {
                counter = document.createElement('div');
                counter.id = counterId;
                counter.className = 'char-counter';
                textarea.after(counter);
            }
            
            counter.textContent = `${current}/${maxLength}`;
            
            if (current > maxLength * 0.9) {
                counter.classList.add('danger');
                counter.classList.remove('warning');
            } else if (current > maxLength * 0.7) {
                counter.classList.add('warning');
                counter.classList.remove('danger');
            } else {
                counter.classList.remove('warning', 'danger');
            }
        }

        // FILTROS DE BÚSQUEDA
        function filterDoctors(query) {
            const cards = document.querySelectorAll('#adminDoctorsList .case-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query.toLowerCase()) ? 'flex' : 'none';
            });
        }

        function filterAdminPatients(query) {
            const cards = document.querySelectorAll('#adminPatientsList .case-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query.toLowerCase()) ? 'flex' : 'none';
            });
        }

        function filterPatients(query) {
            const cards = document.querySelectorAll('#doctorPatientsList .case-card');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query.toLowerCase()) ? 'flex' : 'none';
            });
        }

        // PWA INSTALL
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPWA').style.display = 'flex';
        });

        document.getElementById('installPWA').addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                showToast(translations[currentLang].app_installed, 'success');
            }
            
            deferredPrompt = null;
            document.getElementById('installPWA').style.display = 'none';
        });
        let stepInterval;

        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('logoLoader').classList.add('hidden');
                document.getElementById('landingPage').classList.remove('hidden');
                animateOnScroll();
            }, 3000);
        });

        // CAMBIO 3: Funciones para cámara y eliminar foto
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById("imagePreview");
            const deleteBtn = document.getElementById("deletePhotoBtn");

            if (!file) {
                preview.style.display = "none";
                deleteBtn.style.display = "none";
                return;
            }

            const reader = new FileReader();
            reader.onload = () => {
                preview.src = reader.result;
                preview.style.display = "block";
                deleteBtn.style.display = "inline-block";
            };
            reader.readAsDataURL(file);
        }

        async function captureFromCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                // Crear elemento de video para capturar
                const video = document.createElement('video');
                video.srcObject = stream;
                video.autoplay = true;
                video.playsInline = true;
                
                // Crear modal para la cámara
                const cameraModal = document.createElement('div');
                cameraModal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.95);
                    z-index: 10002;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    gap: 20px;
                `;
                
                video.style.cssText = `
                    max-width: 90%;
                    max-height: 70vh;
                    border-radius: 12px;
                `;
                
                const captureBtn = document.createElement('button');
                captureBtn.innerHTML = `<i class="fa-solid fa-camera"></i> ${translations[currentLang].take_photo}`;
                captureBtn.style.cssText = `
                    padding: 10px 24px;
                    background: #0EA5E9;
                    color: white;
                    border: none;
                    border-radius: 12px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
                `;
                
                const cancelBtn = document.createElement('button');
                cancelBtn.innerHTML = '<i class="fa-solid fa-times"></i> Cancel';
                cancelBtn.style.cssText = `
                    padding: 10px 24px;
                    background: #ef4444;
                    color: white;
                    border: none;
                    border-radius: 12px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                `;
                
                cameraModal.appendChild(video);
                cameraModal.appendChild(captureBtn);
                cameraModal.appendChild(cancelBtn);
                document.body.appendChild(cameraModal);
                
                // Función para capturar la foto
                captureBtn.onclick = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    
                    canvas.toBlob((blob) => {
                        const file = new File([blob], `photo_${Date.now()}.jpg`, { type: 'image/jpeg' });
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        document.getElementById('uploadImage').files = dataTransfer.files;
                        
                        // Mostrar preview
                        const preview = document.getElementById("imagePreview");
                        preview.src = URL.createObjectURL(blob);
                        preview.style.display = "block";
                        document.getElementById("deletePhotoBtn").style.display = "inline-block";
                        
                        // Cerrar modal
                        stream.getTracks().forEach(track => track.stop());
                        document.body.removeChild(cameraModal);
                    }, 'image/jpeg', 0.95);
                };
                
                // Cancelar
                cancelBtn.onclick = () => {
                    stream.getTracks().forEach(track => track.stop());
                    document.body.removeChild(cameraModal);
                };
                
            } catch (error) {
                console.error('Error al acceder a la cámara:', error);
                showToast(translations[currentLang].camera_access_error, 'error');
            }
        }

        function deleteSelectedPhoto() {
            const fileInput = document.getElementById('uploadImage');
            const preview = document.getElementById("imagePreview");
            const deleteBtn = document.getElementById("deletePhotoBtn");
            
            fileInput.value = '';
            preview.src = '';
            preview.style.display = 'none';
            deleteBtn.style.display = 'none';
        }

        async function uploadCase() {
            const fileInput = document.getElementById("uploadImage");
            const patientId = localStorage.getItem("patient_id");
            const uploadBtn = document.getElementById("uploadBtn");

            if (fileInput.files.length === 0) {
                showToast(translations[currentLang].select_image_first, "warning");
                return;
            }

            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append("foto", file);
            formData.append("id_patient", patientId);

            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Enviando...';
            showLoading("Analizando con IA...");

            try {
                const response = await fetch(`${API}/upload-case`, {
                    method: "POST",
                    body: formData
                });

                hideLoading();

                if (response.ok) {
                    showToast(translations[currentLang].consultation_sent, "success");
                    deleteSelectedPhoto();
                    loadPatientHistory();
                } else {
                    showToast(translations[currentLang].send_consultation_error, "error");
                }
            } catch (error) {
                console.error("Error:", error);
                hideLoading();
                showToast(translations[currentLang].server_connection_error, "error");
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = 'Enviar Consulta';
            }
        }

        // CAMBIO 5: Funciones para modal de imagen
        function openImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.classList.remove('hidden');
            modalImg.src = imageSrc;
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
        }

        function changeStep(step) {
            document.querySelectorAll('.step-animation').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.step-indicator').forEach(i => i.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            document.querySelectorAll('.step-indicator')[step - 1].classList.add('active');
            currentStep = step;
        }

        function autoChangeStep() {
            currentStep = currentStep >= 3 ? 1 : currentStep + 1;
            changeStep(currentStep);
        }

        stepInterval = setInterval(autoChangeStep, 4000);

        function updateHistory(view) {
            currentView = view;
            history.pushState({ view: view }, '', `#${view}`);
        }

        window.addEventListener('popstate', function (event) {
            if (event.state && event.state.view) {
                navigateToView(event.state.view);
            } else {
                navigateToView('landing');
            }
        });

        function navigateToView(view) {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('patientDashboard').classList.add('hidden');
            document.getElementById('doctorDashboard').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');

            if (view === 'landing') document.getElementById('landingPage').classList.remove('hidden');
            else if (view === 'login') document.getElementById('loginPage').classList.remove('hidden');
            else if (view === 'patient') document.getElementById('patientDashboard').classList.remove('hidden');
            else if (view === 'doctor') document.getElementById('doctorDashboard').classList.remove('hidden');
            else if (view === 'admin') document.getElementById('adminDashboard').classList.remove('hidden');

            currentView = view;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showLogin() {
            updateHistory('login');
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showLanding() {
            updateHistory('landing');
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('landingPage').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        const animateOnScroll = () => {
            const elements = document.querySelectorAll('.animate-on-scroll, .animate-scale');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
            elements.forEach(el => observer.observe(el));
        };

        const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        function initScrollAnimations() {
            const elements = document.querySelectorAll('.case-card, .container, .tabs, .reveal-on-scroll');
            elements.forEach(el => observer.observe(el));
        }

        function scrollToBottom() {
            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
            }, 150);
        }

        async function handleLogin() {
            const emailInput = document.getElementById("email");
            const passwordInput = document.getElementById("password");
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            // Validar inputs
            const emailValid = validateInput(emailInput, { required: true });
            const passwordValid = validateInput(passwordInput, { required: true, minLength: 4 });

            if (!emailValid || !passwordValid) {
                showToast(translations[currentLang].complete_fields, "error");
                return;
            }

            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Iniciando...';

            try {
                const res = await fetch(`${API}/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (!data.success) {
                    showToast(translations[currentLang].wrong_credentials, "error");
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = translations[currentLang].login_btn;
                    return;
                }
                
                showToast(translations[currentLang].welcome, "info");

                document.getElementById("loginPage").classList.add("hidden");
                document.getElementById("landingPage").classList.add("hidden");

                const role = data.role.toLowerCase();

                if (role === "patient" || role === "patients") {
                    updateHistory('patient');
                    document.getElementById("patientDashboard").classList.remove("hidden");
                    document.getElementById("p_name").innerText = data.user.name;
                    localStorage.setItem("patient_id", data.user.id);
                    localStorage.setItem("token", data.token);
                    loadPatientHistory();
                    loadPatientAppointments();
                } else if (role === "doctor" || role === "doctors") {
                    updateHistory('doctor');
                    document.getElementById("doctorDashboard").classList.remove("hidden");
                    document.getElementById("d_name").innerText = data.user.name;
                    localStorage.setItem("doctor_id", data.user.id);
                    localStorage.setItem("token", data.token);
                    loadDoctorPatients();
                    loadDoctorPending();
                    loadDoctorAppointments();
                } else if (role === "admin") {
                    updateHistory('admin');
                    document.getElementById("adminDashboard").classList.remove("hidden");
                    loadAdminDoctors();
                    loadAdminPatients();
                }

                setTimeout(initScrollAnimations, 100);
                loginBtn.disabled = false;
                loginBtn.innerHTML = translations[currentLang].login_btn;

            } catch (error) {
                console.error(error);
                showToast(translations[currentLang].connection_error, "error");
                loginBtn.disabled = false;
                loginBtn.innerHTML = translations[currentLang].login_btn;
            }
        }

        function logout() {
            // Volver al login en lugar de landing
            document.getElementById('patientDashboard').classList.add('hidden');
            document.getElementById('doctorDashboard').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            
            // Limpiar datos
            localStorage.clear();
            
            // Scroll top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Función de toggle modo oscuro
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            
            // Guardar preferencia
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            // Actualizar iconos y textos
            const icons = ['darkModeIcon', 'darkModeIconDoctor', 'darkModeIconAdmin'];
            const texts = ['darkModeText', 'darkModeTextDoctor', 'darkModeTextAdmin'];
            
            icons.forEach(id => {
                const icon = document.getElementById(id);
                if (icon) {
                    icon.className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
                }
            });
            
            texts.forEach(id => {
                const text = document.getElementById(id);
                if (text) {
                    text.textContent = isDark ? 'Light Mode' : 'Dark Mode';
                }
            });
            
            showToast(isDark ? translations[currentLang].dark_mode_on : translations[currentLang].light_mode_on, 'info');
        }

        // Cargar preferencia de modo oscuro al iniciar
        window.addEventListener('DOMContentLoaded', () => {
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === 'true') {
                document.body.classList.add('dark-mode');
                const icons = ['darkModeIcon', 'darkModeIconDoctor', 'darkModeIconAdmin'];
                const texts = ['darkModeText', 'darkModeTextDoctor', 'darkModeTextAdmin'];
                
                icons.forEach(id => {
                    const icon = document.getElementById(id);
                    if (icon) icon.className = 'fa-solid fa-sun';
                });
                
                texts.forEach(id => {
                    const text = document.getElementById(id);
                    if (text) text.textContent = 'Modo Claro';
                });
            }
        });

        function openTab(tabId, btnElement) {
            const activeDashboard = document.querySelector('.container:not(.hidden)');
            if (activeDashboard) {
                activeDashboard.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
                activeDashboard.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
                const targetContent = activeDashboard.querySelector(`#${tabId}`);
                if (targetContent) targetContent.classList.add('active');
                if (btnElement) btnElement.classList.add('active');
            }
            setTimeout(initScrollAnimations, 50);
        }

        async function loadPatientHistory() {
            const patientId = localStorage.getItem("patient_id");
            try {
                const res = await fetch(`${API}/patient/history?id_patient=${patientId}`);
                const history = await res.json();
                const list = document.getElementById("patientHistoryList");
                list.innerHTML = "";

                if (!history.length) {
                    list.innerHTML = `<div class="case-card"><p style="color:#888;">No se encontró historial.</p></div>`;
                    return;
                }

                history.forEach(h => {
                    const fecha = new Date(h.diagnosis_date).toLocaleDateString("es-ES");
                    list.innerHTML += `
            <div class="case-card urgency-low">
                <p style="font-size:14px; color:#888;">${fecha}</p>
                <div style="display:flex; gap:15px; margin-top:10px;">
                    <img src="${h.file_path || 'https://via.placeholder.com/100'}" style="width:80px; height:80px; border-radius:8px; object-fit: cover;">
                    <div>
                        <strong>${h.disease}</strong>
                        <p style="margin-top:5px; font-size:14px;">${h.doctor_notes || ''}</p>
                    </div>
                </div>
            </div>`;
                });
                initScrollAnimations();
            } catch (err) { console.error(err); }
        }

        async function loadPatientAppointments() {
            const patientId = localStorage.getItem("patient_id");
            try {
                const res = await fetch(`${API}/patient/appointments?id_patient=${patientId}`);
                const citas = await res.json();
                const list = document.getElementById("patientAppointmentsList");
                list.innerHTML = "";

                if (!citas.length) {
                    list.innerHTML = `<div class="case-card"><p style="color:#888;">No tienes citas próximas.</p></div>`;
                    return;
                }

                citas.forEach(c => {
                    const fecha = new Date(c.date);
                    const dia = fecha.getDate().toString().padStart(2, '0');
                    const mesNum = fecha.getMonth();
                    const mesKey = `month_${mesNum + 1}`;
                    const mes = translations[currentLang][mesKey] ? translations[currentLang][mesKey].toUpperCase() : fecha.toLocaleString('es-ES', { month: 'short' }).toUpperCase();
                    const hora = fecha.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });

                    list.innerHTML += `
                <div class="case-card urgency-medium">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <h4 style="margin:0;">${translations[currentLang].appointment_with || 'Cita con'} ${c.doctor_name}</h4>
                            <p style="margin:5px 0 0 0; color:#64748B;">${translations[currentLang].status} ${translateStatus(c.status)}</p>
                        </div>
                        <div style="text-align:right;">
                            <span style="font-weight:bold; color:var(--sk-blue-dark);">${dia} ${mes}</span><br>
                            <span style="font-size:14px;">${hora}</span>
                        </div>
                    </div>
                </div>`;
                });
                initScrollAnimations();
            } catch (err) { console.error(err); }
        }

        // CAMBIO 5: Imagen clickeable en pending
        async function loadDoctorPending() {
            const doctorId = localStorage.getItem("doctor_id");
            const res = await fetch(`${API}/doctor/pending?id_doctor=${doctorId}`);
            const cases = await res.json();
            const list = document.getElementById("doctorPendingList");
            list.innerHTML = "";

            const AHORA = Date.now();
            const TREINTA_MINUTOS_MS = 30 * 60 * 1000;

            cases.forEach(c => {
                let badgeClass = 'badge-low';
                let cardClass = 'doctor-urgency-low';
                let alertaRetraso = "";

                if (c.urgency === 3) { badgeClass = 'badge-high'; cardClass = 'urgency-high'; }
                else if (c.urgency === 2) { badgeClass = 'badge-medium'; cardClass = 'urgency-medium'; }

                const tiempoEsperaMs = AHORA - c.ia_confidence_millis;
                const minutosEspera = Math.floor(tiempoEsperaMs / (1000 * 60));

                if (tiempoEsperaMs > TREINTA_MINUTOS_MS) {
                    alertaRetraso = `
                <div style="background: #fee2e2; color: #b91c1c; padding: 8px; border-radius: 8px; margin-top: 10px; font-size: 13px; font-weight: bold; border: 1px solid #f87171;">
                    <i class="fa-solid fa-triangle-exclamation"></i> 
                    ${translations[currentLang].waiting_alert} ${minutosEspera} ${translations[currentLang].minutes_abbr}
                </div>`;
                }

                const imagePath = `http://localhost:8080${c.file_path}`;

                list.innerHTML += `
            <div class="case-card ${cardClass}">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>${c.name}</h3>
                    <span class="urgency-badge ${badgeClass}" style="box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3); font-weight: 800;">${Math.round(c.ia_confidence)}% ${translations[currentLang].ai_risk}</span>
                </div>
                
                <img src="${imagePath}" 
                     class="clickable-image" 
                     onclick="openImageModal('${imagePath}')"
                     style="width:100%; height:200px; object-fit:cover; margin: 15px 0; border-radius:12px; border: 1px solid #eee;">
                
                <div style="background: #f0f9ff; padding: 10px; border-radius: 8px; margin-bottom: 5px; border-left: 4px solid #0ea5e9;">
                    <p style="margin:0; font-size:12px; color:#0369a1; font-weight:bold;">${translations[currentLang].ai_suggestion}:</p>
                    <p style="margin:0; font-size:15px; color:#1e40af;">${c.ia_suggestion || translations[currentLang].analyzing}</p>
                </div>

                ${alertaRetraso}
                
                <div style="margin-top:15px;">
                    <label style="font-size:12px; font-weight:bold;">${translations[currentLang].final_diagnosis}</label>
                    <select id="disease-${c.id_request}" style="width:100%; padding:10px; margin: 8px 0;">
                        <option value="1">${translations[currentLang].disease_acne}</option>
                        <option value="2">${translations[currentLang].disease_keratosis}</option>
                        <option value="12">${translations[currentLang].disease_melanoma}</option>
                        <option value="15">${translations[currentLang].disease_psoriasis}</option>
                    </select>
                    <textarea id="notes-${c.id_request}" placeholder="${translations[currentLang].treatment_placeholder}" rows="2" style="width:100%; padding:10px;" maxlength="500" oninput="updateCharCount(this)"></textarea>
                    <input type="datetime-local" id="appointment-${c.id_request}" style="width:100%; padding:10px; margin-top:10px;">
                    <button onclick="sendDiagnosis(${c.id_request}, ${doctorId}, ${c.id_patient})" style="margin-top:10px;">${translations[currentLang].complete_review}</button>
                </div>
            </div>`;
            });
            initScrollAnimations();
        }

        async function loadDoctorPatients() {
            const doctorId = localStorage.getItem("doctor_id");
            try {
                const res = await fetch(`${API}/doctor/patients?id_doctor=${doctorId}`);
                const patients = await res.json();
                const list = document.getElementById("doctorPatientsList");
                list.innerHTML = "";

                patients.forEach(p => {
                    list.innerHTML += `
                <div class="case-card reveal-on-scroll" style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <strong>${p.name}</strong><br>
                        <span style="font-size:14px; color:#888;">ID: ${p.dni} • ${p.email}</span>
                    </div>
                </div>`;
                });
                initScrollAnimations();
            } catch (err) { console.error(err); }
        }

        async function loadDoctorAppointments() {
            const doctorId = localStorage.getItem("doctor_id");
            try {
                const res = await fetch(`${API}/doctor/appointments?id_doctor=${doctorId}`);
                const citas = await res.json();
                const list = document.getElementById("doctorAppointmentsList");
                list.innerHTML = "";

                if (!citas.length) {
                    list.innerHTML = `<div class="case-card reveal-on-scroll"><p style="color:#888;">${translations[currentLang].no_appointments}</p></div>`;
                    return;
                }

                citas.forEach(c => {
                    const fecha = new Date(c.date);
                    const dia = fecha.getDate().toString().padStart(2, '0');
                    const mesNum = fecha.getMonth();
                    const mesKey = `month_${mesNum + 1}`;
                    const mes = translations[currentLang][mesKey] ? translations[currentLang][mesKey].toUpperCase() : fecha.toLocaleString('es-ES', { month: 'short' }).toUpperCase();
                    const hora = fecha.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });

                    let estadoColor = "#999";
                    if (c.status === 'pending' || c.status === 'pendiente') estadoColor = "#d39e00";
                    if (c.status === 'done' || c.status === 'completado') estadoColor = "#28a745";
                    if (c.status === 'cancel' || c.status === 'cancelado') estadoColor = "#dc3545";

                    list.innerHTML += `
                <div class="case-card reveal-on-scroll" style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <strong>${c.patient_name}</strong><br>
                        <span style="font-size:14px;">${dia} ${mes} • ${hora}</span><br>
                        <span style="font-size:13px; color:#888; margin-top:8px; display:inline-block;">${translations[currentLang].status} <b style="color:${estadoColor};">${translateStatus(c.status)}</b></span>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn-secondary" onclick="editAppointment(${c.id_appointment}, '${c.date}', ${c.id_patient})" style="width:auto; padding:10px 20px;">${translations[currentLang].edit}</button>
                        <button class="btn-secondary delete-btn" style="width:auto; padding:10px 20px;" onclick="deleteAppointment(${c.id_appointment}, ${c.id_patient})">${translations[currentLang].delete}</button>
                    </div>
                </div>`;
                });
                initScrollAnimations();
            } catch (err) { console.error(err); }
        }

        async function sendDiagnosis(reqId, docId, patId) {
            const diseaseSelect = document.getElementById(`disease-${reqId}`);
            const notesInput = document.getElementById(`notes-${reqId}`);
            const appointmentInput = document.getElementById(`appointment-${reqId}`);

            const diseaseId = diseaseSelect.value;
            const notes = notesInput.value;

            if (!notes) {
                showToast(translations[currentLang].write_notes, "warning");
                return;
            }

            const payload = {
                id_request: reqId,
                id_doctor: docId,
                id_patient: patId,
                id_skindiseases: parseInt(diseaseId),
                confidence: 100,
                doctor_notes: notes,
                appointment_date: appointmentInput.value
            };

            showLoading("Enviando diagnóstico...");

            try {
                const res = await fetch(`${API}/doctor/send_report`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const result = await res.json();
                hideLoading();

                if (res.ok) {
                    showToast(translations[currentLang].report_sent, "success");
                    loadDoctorPending();
                    loadDoctorAppointments();
                } else {
                    showToast("Error: " + JSON.stringify(result), "error");
                }
            } catch (e) {
                console.error(e);
                hideLoading();
                showToast(translations[currentLang].report_send_error, "error");
            }
        }

        async function editAppointment(id_appointment, currentDate, patientId) {
            const newDate = prompt("Selecciona nueva fecha y hora (YYYY-MM-DDTHH:MM):", currentDate.slice(0, 16));
            if (!newDate) return;

            showLoading("Actualizando cita...");

            try {
                const res = await fetch(`${API}/appointment/${id_appointment}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ date: newDate })
                });

                hideLoading();

                if (res.ok) {
                    showToast(translations[currentLang].appointment_updated, "success");
                    await loadDoctorAppointments();
                    await loadPatientAppointments();
                } else {
                    const data = await res.json();
                    showToast(translations[currentLang].appointment_update_error + ": " + JSON.stringify(data), "error");
                }
            } catch (err) {
                console.error(err);
                hideLoading();
                showToast(translations[currentLang].appointment_update_error, "error");
            }
        }

        async function deleteAppointment(id_appointment, patientId) {
            showConfirm(
                translations[currentLang].delete_appointment_title,
                translations[currentLang].delete_appointment_msg,
                "",
                async () => {
                    showLoading(translations[currentLang].deleting);
                    try {
                        const res = await fetch(`${API}/appointment/${id_appointment}`, {
                            method: "DELETE"
                        });

                        if (!res.ok) {
                            const data = await res.json();
                            throw new Error(JSON.stringify(data));
                        }

                        await loadDoctorAppointments();
                        await loadPatientAppointments();
                        await loadPatientHistory();

                        hideLoading();
                        showToast(translations[currentLang].appointment_deleted, "success");

                    } catch (err) {
                        console.error(err);
                        hideLoading();
                        showToast(translations[currentLang].appointment_delete_error, "error");
                    }
                }
            );
        }

        let stream = null;
        async function toggleCamera() {
            const video = document.getElementById('camera-preview');
            const btn = document.getElementById('btnCamera');

            if (video.style.display === 'none') {
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                    video.srcObject = stream;
                    video.style.display = 'block';
                    btn.innerHTML = '<i class="fa-solid fa-stop"></i> Detener';
                    btn.style.backgroundColor = "#ef4444";
                    btn.style.color = "#ffffff";
                } catch (e) { showToast(translations[currentLang].camera_not_available, "error"); }
            } else {
                if (stream) stream.getTracks().forEach(t => t.stop());
                video.style.display = 'none';
                btn.innerHTML = '<i class="fa-solid fa-camera"></i> Iniciar';
                btn.style.backgroundColor = "#0EA5E9";
                btn.style.color = "#000000";
            }
        }

        // CAMBIO 6: Admin con botones separados
        async function loadAdminDoctors() {
            const res = await fetch(`${API}/admin/doctors`);
            const doctors = await res.json();
            const list = document.getElementById("adminDoctorsList");
            list.innerHTML = "";

            doctors.forEach(d => {
                list.innerHTML += `
        <div class="case-card" style="display:flex;justify-content:space-between; align-items:center;">
            <div>
                <strong>${d.name}</strong><br>
                <span style="color:#888">${d.email} • ${d.clinic || ''}</span>
            </div>
            <div class="admin-button-group">
                <button class="btn-secondary" onclick="editDoctor(${d.id_doctor})">
                    <i class="fa-solid fa-edit"></i> ${translations[currentLang].edit}
                </button>
                <button class="btn-secondary" style="color:red;" onclick="deleteDoctor(${d.id_doctor})">
                    <i class="fa-solid fa-trash"></i> ${translations[currentLang].delete}
                </button>   
            </div>
        </div>`;
            });
        }

        async function loadAdminPatients() {
            const res = await fetch(`${API}/admin/patients`);
            const patients = await res.json();
            const list = document.getElementById("adminPatientsList");
            list.innerHTML = "";

            patients.forEach(p => {
                list.innerHTML += `
        <div class="case-card" style="display:flex;justify-content:space-between; align-items:center;">
            <div>
                <strong>${p.name}</strong><br>
                <span style="color:#888">${p.email} • Doctor: ${p.doctor || '—'}</span>
            </div>
            <div class="admin-button-group">
                <button class="btn-secondary" onclick="editPatient(${p.id_patient})">
                    <i class="fa-solid fa-edit"></i> ${translations[currentLang].edit}
                </button>
                <button class="btn-secondary" style="color:red;" onclick="deletePatient(${p.id_patient})">
                    <i class="fa-solid fa-trash"></i> ${translations[currentLang].delete}
                </button>
            </div>
        </div>`;
            });
        }

        async function deleteDoctor(id) {
            showConfirm(
                translations[currentLang].delete_doctor_title,
                translations[currentLang].delete_doctor_msg,
                "",
                async () => {
                    showLoading(translations[currentLang].deleting);
                    try {
                        const res = await fetch(`${API}/admin/doctor/${id}`, { method: "DELETE" });
                        const data = await res.json();
                        
                        hideLoading();
                        
                        if (res.ok) {
                            showToast(translations[currentLang].doctor_deleted, "success");
                            loadAdminDoctors();
                            loadAdminPatients();
                        } else {
                            showToast(translations[currentLang].doctor_delete_error, "error");
                        }
                    } catch (err) {
                        console.error(err);
                        hideLoading();
                        showToast(translations[currentLang].doctor_delete_error, "error");
                    }
                }
            );
        }

        async function deletePatient(id) {
            showConfirm(
                translations[currentLang].delete_patient_title,
                translations[currentLang].delete_patient_msg,
                "",
                async () => {
                    showLoading(translations[currentLang].deleting);
                    try {
                        const res = await fetch(`${API}/admin/patient/${id}`, { method: "DELETE" });
                        const data = await res.json();
                        
                        hideLoading();
                        
                        if (res.ok) {
                            showToast(translations[currentLang].patient_deleted, "success");
                            loadAdminPatients();
                        } else {
                            showToast(translations[currentLang].patient_delete_error, "error");
                        }
                    } catch (err) {
                        console.error(err);
                        hideLoading();
                        showToast(translations[currentLang].patient_delete_error, "error");
                    }
                }
            );
        }

        // CAMBIO 7: Modal corregido
        function openNewDoctor() {
            document.getElementById("modal-title").innerText = translations[currentLang].modal_new_doctor_title;
            document.getElementById("modal-body").innerHTML = `
                <input id="new_doctor_code" placeholder="${translations[currentLang].doctor_code}">
                <input id="new_doctor_name" placeholder="${translations[currentLang].full_name}">
                <input id="new_doctor_email" placeholder="${translations[currentLang].email_address}">
                <input id="new_doctor_password" type="password" placeholder="${translations[currentLang].temp_password}">
                <input id="new_doctor_clinic" placeholder="${translations[currentLang].clinic_id_optional}">
            `;
            openModal("doctor", false);
        }

        function openNewPatient() {
            document.getElementById("modal-title").innerText = translations[currentLang].modal_new_patient_title;
            document.getElementById("modal-body").innerHTML = `
                <input id="new_patient_dni" placeholder="${translations[currentLang].dni_id}">
                <input id="new_patient_name" placeholder="${translations[currentLang].full_name}">
                <input id="new_patient_email" placeholder="${translations[currentLang].email_address}">
                <input id="new_patient_password" type="password" placeholder="${translations[currentLang].temp_password}">
                <select id="new_patient_doctor">
                    <option value="">${translations[currentLang].no_doctor_assigned}</option>
                </select>
            `;
            openModal("patient", false);
            loadDoctorsForSelect();
        }

        async function loadDoctorsForSelect() {
            try {
                const res = await fetch(`${API}/admin/doctors`);
                const doctors = await res.json();
                const select = document.getElementById("new_patient_doctor");
                if (!select) return;

                doctors.forEach(d => {
                    const option = document.createElement("option");
                    option.value = d.id_doctor;
                    option.textContent = `${d.name} (${d.email})`;
                    select.appendChild(option);
                });
            } catch (err) {
                console.error(err);
                alert("Error cargando doctores");
            }
        }

        let currentType = null;
        let isEditing = false;

        function openModal(type, editing = false) {
            currentType = type;
            isEditing = editing;
            document.getElementById("modal").classList.remove("hidden");
        }

        function closeModal() {
            document.getElementById("modal").classList.add("hidden");
        }

        function modalSave() {
            if (isEditing) {
                submitFormEdit();
            } else {
                submitForm();
            }
        }

        async function submitForm() {
            let payload = {};

            if (currentType === "doctor") {
                payload = {
                    doctor_code: document.getElementById("new_doctor_code").value,
                    name: document.getElementById("new_doctor_name").value,
                    email: document.getElementById("new_doctor_email").value,
                    password: document.getElementById("new_doctor_password").value,
                    id_clinic: document.getElementById("new_doctor_clinic").value || null
                };

                try {
                    const res = await fetch(`${API}/admin/new/doctor`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });
                    const data = await res.json();
                    if (res.ok) {
                        alert("Doctor creado correctamente!");
                        closeModal();
                        loadAdminDoctors();
                    } else {
                        alert(translations[currentLang].connection_error + ": " + JSON.stringify(data));
                    }
                } catch (err) {
                    console.error(err);
                    alert("Error de conexión con el servidor.");
                }

            } else if (currentType === "patient") {
                payload = {
                    dni: document.getElementById("new_patient_dni").value,
                    name: document.getElementById("new_patient_name").value,
                    email: document.getElementById("new_patient_email").value,
                    password: document.getElementById("new_patient_password").value,
                    id_doctor: document.getElementById("new_patient_doctor").value || null
                };

                try {
                    const res = await fetch(`${API}/admin/new/patient`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });
                    const data = await res.json();
                    if (res.ok) {
                        alert("Paciente creado correctamente!");
                        closeModal();
                        loadAdminPatients();
                    } else {
                        alert(translations[currentLang].connection_error + ": " + JSON.stringify(data));
                    }
                } catch (err) {
                    console.error(err);
                    alert("Error de conexión con el servidor.");
                }
            }
        }

        async function editDoctor(id_doctor) {
            try {
                const res = await fetch(`${API}/admin/doctor/${id_doctor}`);
                if (!res.ok) throw new Error("Doctor no encontrado");
                const doctor = await res.json();

                document.getElementById("modal-title").innerText = "Editar Doctor";
                document.getElementById("modal-body").innerHTML = `
            <input type="hidden" id="edit_doctor_id" value="${doctor.id_doctor}">
            <input id="edit_doctor_code" placeholder="Código Doctor" value="${doctor.doctor_code}">
            <input id="edit_doctor_name" placeholder="Nombre Completo" value="${doctor.name}">
            <input id="edit_doctor_email" placeholder="Correo electrónico" value="${doctor.email}">
            <input id="edit_doctor_password" type="password" placeholder="Contraseña (dejar en blanco)">
            <input id="edit_doctor_clinic" placeholder="ID Clínica" value="${doctor.id_clinic || ''}">
        `;

                currentType = "doctor";
                isEditing = true;
                openModal("doctor", true);
                scrollToBottom();
            } catch (err) {
                console.error(err);
                alert("Error al obtener datos del doctor");
            }
        }

        async function editPatient(id_patient) {
            try {
                const res = await fetch(`${API}/admin/patient/${id_patient}`);
                if (!res.ok) throw new Error("Paciente no encontrado");
                const patient = await res.json();

                document.getElementById("modal-title").innerText = "Editar Paciente";
                document.getElementById("modal-body").innerHTML = `
            <input type="hidden" id="edit_patient_id" value="${patient.id_patient}">
            <input id="edit_patient_dni" placeholder="DNI / Cédula" value="${patient.dni}">
            <input id="edit_patient_name" placeholder="Nombre Completo" value="${patient.name}">
            <input id="edit_patient_email" placeholder="Correo electrónico" value="${patient.email}">
            <input id="edit_patient_password" type="password" placeholder="Contraseña (dejar en blanco)">
            <select id="edit_patient_doctor">
                <option value="">Sin doctor asignado</option>
            </select>
        `;

                const doctorRes = await fetch(`${API}/admin/doctors`);
                const doctors = await doctorRes.json();
                const select = document.getElementById("edit_patient_doctor");
                doctors.forEach(d => {
                    const option = document.createElement("option");
                    option.value = d.id_doctor;
                    option.textContent = `${d.name} (${d.email})`;
                    if (d.id_doctor === patient.id_doctor) option.selected = true;
                    select.appendChild(option);
                });

                currentType = "patient";
                isEditing = true;
                openModal("patient", true);
                scrollToBottom();

            } catch (err) {
                console.error(err);
                alert("Error al obtener datos del paciente");
            }
        }

        async function submitFormEdit() {
            let payload = {};
            let endpoint = "";
            let method = "PUT";

            if (currentType === "doctor") {
                const idDoctor = document.getElementById("edit_doctor_id").value;
                if (!idDoctor) return alert("No se encontró el ID del doctor.");

                payload = {
                    name: document.getElementById("edit_doctor_name").value,
                    email: document.getElementById("edit_doctor_email").value,
                    id_clinic: document.getElementById("edit_doctor_clinic").value || null
                };

                const password = document.getElementById("edit_doctor_password").value;
                if (password) payload.password = password;

                endpoint = `${API}/admin/doctor/${idDoctor}`;

            } else if (currentType === "patient") {
                const idPatient = document.getElementById("edit_patient_id").value;
                if (!idPatient) return alert("No se encontró el ID del paciente.");

                payload = {
                    name: document.getElementById("edit_patient_name").value,
                    email: document.getElementById("edit_patient_email").value,
                    dni: document.getElementById("edit_patient_dni").value,
                    id_doctor: document.getElementById("edit_patient_doctor").value || null
                };

                const password = document.getElementById("edit_patient_password").value;
                if (password) payload.password = password;

                endpoint = `${API}/admin/patient/${idPatient}`;
            }

            try {
                const res = await fetch(endpoint, {
                    method,
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();

                if (res.ok) {
                    alert(`${currentType === "doctor" ? "Doctor" : "Paciente"} actualizado correctamente!`);
                    closeModal();
                    loadAdminDoctors();
                    loadAdminPatients();
                } else {
                    alert("Error al actualizar: " + JSON.stringify(data));
                }

            } catch (err) {
                console.error(err);
                showToast("Error de conexión con el servidor", "error");
            }
        }

        // DRAG & DROP para subir imágenes
        const dropZone = document.getElementById('dropZone');
        if (dropZone) {
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    document.getElementById('uploadImage').files = dataTransfer.files;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        document.getElementById('imagePreview').src = event.target.result;
                        document.getElementById('imagePreview').style.display = 'block';
                        document.getElementById('deletePhotoBtn').style.display = 'inline-block';
                    };
                    reader.readAsDataURL(file);
                    showToast(translations[currentLang].image_loaded, "success");
                } else {
                    showToast(translations[currentLang].drag_only_images, "warning");
                }
            });
        }

        // TEXT-TO-SPEECH FUNCTIONS FOR MINI-XPERT
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;

        function stopSpeech() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                document.getElementById('speechStatus').style.display = 'none';
                document.getElementById('stopSpeechBtn').style.display = 'none';
                showToast(translations[currentLang].speech_stopped, "info");
            }
        }

        async function readHistory() {
            stopSpeech();
            
            try {
                const patient_id = localStorage.getItem("patient_id");
                if (!patient_id) {
                    speak("Please log in to access your history.");
                    return;
                }
                
                const res = await fetch(`${API}/patient/history?id_patient=${patient_id}`);
                
                if (!res.ok) {
                    throw new Error("Failed to load history");
                }
                
                const history = await res.json();
                
                if (!history || history.length === 0) {
                    speak("You have no medical history yet.");
                    return;
                }
                
                let text = "Your medical history. ";
                
                history.forEach((item, index) => {
                    const date = new Date(item.diagnosis_date).toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    
                    text += `Entry ${index + 1}. Date: ${date}. `;
                    
                    if (item.disease) {
                        text += `Disease: ${item.disease}. `;
                    }
                    
                    if (item.doctor_notes) {
                        text += `Notes: ${item.doctor_notes}. `;
                    }
                    
                    text += ". ";
                });
                
                speak(text);
                
            } catch (error) {
                console.error("Error in readHistory:", error);
                speak("Error loading medical history.");
                showToast("Error loading history", "error");
            }
        }

        async function readAppointments() {
            stopSpeech();
            
            try {
                const patient_id = localStorage.getItem("patient_id");
                if (!patient_id) {
                    speak("Please log in to access your appointments.");
                    return;
                }
                
                const res = await fetch(`${API}/patient/appointments?id_patient=${patient_id}`);
                
                if (!res.ok) {
                    throw new Error("Failed to load appointments");
                }
                
                const appointments = await res.json();
                
                if (!appointments || appointments.length === 0) {
                    speak("You have no upcoming appointments.");
                    return;
                }
                
                let text = "Your appointments. ";
                
                appointments.forEach((apt, index) => {
                    const date = new Date(apt.date);
                    const dateStr = date.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    const timeStr = date.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    text += `Appointment ${index + 1}. Date: ${dateStr} at ${timeStr}. `;
                    
                    if (apt.status) {
                        text += `Status: ${apt.status}. `;
                    }
                    
                    text += ". ";
                });
                
                speak(text);
                
            } catch (error) {
                console.error("Error in readAppointments:", error);
                speak("Error loading appointments.");
                showToast("Error loading appointments", "error");
            }
        }

        function speak(text) {
            console.log("Speaking:", text);
            
            if (!('speechSynthesis' in window)) {
                showToast("Speech not supported in this browser", "error");
                return;
            }
            
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            // Wait a bit for cancel to complete
            setTimeout(() => {
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = 'en-US';
                currentUtterance.rate = 0.9;
                currentUtterance.pitch = 1;
                currentUtterance.volume = 1;
                
                // Show status
                document.getElementById('speechStatus').style.display = 'block';
                document.getElementById('stopSpeechBtn').style.display = 'inline-block';
                document.getElementById('speechStatusText').textContent = 'Reading...';
                
                currentUtterance.onstart = () => {
                    console.log("Speech started");
                };
                
                currentUtterance.onend = () => {
                    console.log("Speech ended");
                    document.getElementById('speechStatus').style.display = 'none';
                    document.getElementById('stopSpeechBtn').style.display = 'none';
                    showToast("Finished reading", "success");
                };
                
                currentUtterance.onerror = (event) => {
                    console.error('Speech error:', event);
                    document.getElementById('speechStatus').style.display = 'none';
                    document.getElementById('stopSpeechBtn').style.display = 'none';
                    showToast("Speech error: " + event.error, "error");
                };
                
                speechSynthesis.speak(currentUtterance);
            }, 100);
        }

        // SISTEMA DE TRADUCCIÓN MULTIIDIOMA
        const translations = {
            es: {
                // Navbar
                nav_home: "Inicio",
                nav_features: "Características",
                nav_how: "Cómo Funciona",
                nav_download: "Descargar",
                nav_login: "Iniciar Sesión",
                
                // Loader
                loader_text: "Cargando experiencia...",
                
                // Hero
                hero_badge: "Tecnología médica avanzada",
                hero_title: "Detección Temprana de Problemas de la Piel al Alcance de tu Mano",
                hero_desc: "SkinXpert utiliza inteligencia artificial avanzada para detectar cánceres de piel y otros problemas dermatológicos. Nuestra IA analiza, prioriza por urgencia y conecta pacientes con especialistas para diagnósticos precisos.",
                hero_btn1: "Comenzar Ahora",
                hero_btn2: "Descargar App",
                hero_feat1: "Análisis en segundos",
                hero_feat2: "Privacidad garantizada",
                hero_feat3: "Fácil de usar",
                hero_tagline: "Detección inteligente de<br>enfermedades de piel",
                
                // Features
                feat_title: "Características Principales",
                feat_desc: "Tecnología médica de vanguardia diseñada para cuidar de tu piel con la mayor precisión y facilidad.",
                feat1_title: "IA Avanzada",
                feat1_desc: "Algoritmos de aprendizaje profundo especializados en detectar cánceres de piel y enfermedades dermatológicas.",
                feat2_title: "Análisis con IA y Revisión Médica",
                feat2_desc: "Captura una foto de tu piel. La IA analiza y detecta posibles problemas, asignando un nivel de urgencia.",
                feat3_title: "100% Privado",
                feat3_desc: "Tus datos de salud están encriptados y nunca son compartidos. Tu privacidad es nuestra prioridad.",
                feat4_title: "Historial Completo",
                feat4_desc: "Guarda y compara análisis a lo largo del tiempo para monitorear cambios en tu piel.",
                feat5_title: "Alertas Inteligentes",
                feat5_desc: "Recibe notificaciones si detectamos cambios significativos que requieran atención médica.",
                feat6_title: "Prevención Proactiva",
                feat6_desc: "Detecta problemas tempranos cuando son más tratables. Tu salud es lo primero.",
                
                // How it works
                how_title: "Cómo Funciona",
                how_desc: "En solo 3 simples pasos, puedes obtener un análisis profesional de tu piel.",
                step1_title: "Captura",
                step1_desc: "Toma una foto clara de la zona de piel que deseas analizar usando tu smartphone",
                step2_title: "Análisis",
                step2_desc: "Nuestra IA analiza la imagen en segundos, comparándola con miles de casos dermatológicos",
                step3_title: "Resultados",
                step3_desc: "Recibe un informe detallado con recomendaciones y si es necesario, consultar a un especialista",
                
                // Testimonials
                test_title: "Lo Que Dicen Nuestros Usuarios",
                test_desc: "Miles de personas confían en SkinXpert para cuidar de su salud dermatológica.",
                test1_text: "Esta app me ayudó a detectar un lunar sospechoso que luego fue confirmado por mi dermatólogo. La detección temprana hizo toda la diferencia.",
                test1_author: "María González",
                test1_role: "Usuario SkinXpert",
                test2_text: "Muy fácil de usar y rápida. Me da tranquilidad poder monitorear mi piel regularmente sin tener que esperar citas médicas.",
                test2_author: "Carlos Ruiz",
                test2_role: "Usuario SkinXpert",
                test3_text: "La interfaz es intuitiva y los resultados son claros. Excelente herramienta para el cuidado preventivo de la piel.",
                test3_author: "Ana Martínez",
                test3_role: "Usuario SkinXpert",
                
                // Download
                down_title: "Descarga SkinXpert",
                down_desc: "Disponible para iOS y Android. Comienza a cuidar tu salud dermatológica hoy mismo.",
                down_ios: "iOS",
                down_ios_desc: "Compatible con iPhone y iPad.<br>Requiere iOS 14.0 o superior.",
                down_ios_btn: "Descargar en App Store",
                down_android: "Android",
                down_android_desc: "Compatible con dispositivos Android.<br>Requiere Android 8.0 o superior.",
                down_android_btn: "Descargar en Google Play",
                
                // CTA
                cta_title: "Protege tu Piel Hoy",
                cta_desc: "La detección temprana puede salvar vidas. Descarga SkinXpert y comienza a cuidar de tu salud dermatológica con la confianza de la tecnología médica avanzada.",
                cta_btn: "Acceder a la Plataforma",
                cta_note: "Sistema disponible para médicos y pacientes",
                
                // Footer
                footer_desc: "Tecnología médica avanzada para la detección temprana de problemas de piel. Tu salud dermatológica es nuestra prioridad.",
                footer_links: "Enlaces",
                footer_about: "Sobre Nosotros",
                footer_privacy: "Privacidad",
                footer_terms: "Términos de Uso",
                footer_support: "Soporte",
                footer_contact: "Contacto",
                footer_copyright: "© 2025 SkinXpert. Todos los derechos reservados.",
                footer_cookies: "Cookies",
                
                // Login
                login_subtitle: "Iniciar sesión para continuar",
                login_email: "Correo electrónico o cédula",
                login_password: "Contraseña",
                login_btn: "Iniciar Sesión",
                login_back: "Volver al inicio",
                
                // Notifications
                install_app: "Instalar App",
                
                // Patient Dashboard
                patient_hello: "Hola",
                patient_role: "Paciente",
                dark_mode: "Modo Oscuro",
                logout: "Salir",
                tab_consultation: "Consulta",
                tab_appointments: "Citas",
                tab_history: "Historial",
                tab_minixpert: "Mini-Xpert",
                new_consultation: "Nueva Consulta",
                new_consultation_desc: "Sube una foto de tu lesión para que tu doctor la evalúe",
                select_file: "Seleccionar Archivo",
                use_camera: "Usar Cámara",
                delete_photo: "Eliminar Foto",
                send_consultation: "Enviar Consulta",
                voice_assistant: "Asistente de Voz Mini-Xpert",
                voice_desc: "Escucha tu información médica en formato de audio",
                read_history: "Leer Historial",
                read_appointments: "Leer Citas",
                appointment_with: "Cita con",
                stop: "Detener",
                reading: "Leyendo...",
                take_photo: "Tomar Foto",
                
                // Doctor Dashboard
                doctor_role: "Dermatología",
                tab_pending: "Pendientes",
                tab_patients: "Pacientes",
                tab_schedule: "Agenda",
                tab_camera: "Cámara",
                sorted_urgency: "Ordenado por Urgencia (IA)",
                search_patient: "Buscar paciente...",
                dermatoscope_viewer: "Visor Dermatoscopio",
                start: "Iniciar",
                
                // Admin Dashboard
                admin_panel: "Panel Admin",
                tab_doctors: "Doctores",
                search_doctor: "Buscar doctor...",
                new_doctor: "Nuevo Doctor",
                new_patient: "Nuevo Paciente",
                
                // New Doctor Modal
                modal_new_doctor_title: "Nuevo Doctor",
                doctor_code: "Código Doctor",
                full_name: "Nombre Completo",
                email_address: "Correo electrónico",
                temp_password: "Contraseña Temporal",
                clinic_id_optional: "ID Clínica (opcional)",
                
                // New Patient Modal
                modal_new_patient_title: "Nuevo Paciente",
                dni_id: "DNI / Cédula",
                no_doctor_assigned: "Sin doctor asignado",
                
                // Modals
                cancel: "Cancelar",
                save: "Guardar",
                confirm: "Confirmar",
                
                // Notifications & Messages
                processing: "Procesando...",
                app_installed: "¡App instalada correctamente!",
                required_field: "Este campo es requerido",
                invalid_email: "Email inválido",
                min_length: "Mínimo {n} caracteres",
                
                // Image modal
                full_image: "Imagen completa",
                
                // Toast Messages
                camera_access_error: "No se pudo acceder a la cámara. Verifica los permisos",
                select_image_first: "Por favor, selecciona una imagen primero",
                consultation_sent: "Consulta enviada. La IA está analizando tu caso",
                send_consultation_error: "Error al enviar la consulta",
                server_connection_error: "No se pudo conectar con el servidor",
                complete_fields: "Por favor completa todos los campos correctamente",
                wrong_credentials: "Credenciales incorrectas",
                welcome: "¡Bienvenido!",
                connection_error: "Error de conexión",
                dark_mode_on: "Modo oscuro activado",
                light_mode_on: "Modo claro activado",
                write_notes: "Por favor escribe algunas notas para el paciente",
                report_sent: "Reporte enviado correctamente",
                report_send_error: "Error de conexión al enviar el reporte",
                appointment_updated: "Cita actualizada correctamente",
                appointment_update_error: "Error al actualizar cita",
                appointment_delete_error: "Error al eliminar cita",
                appointment_deleted: "Cita eliminada correctamente",
                camera_not_available: "Cámara no disponible",
                doctor_deleted: "Doctor eliminado correctamente",
                doctor_delete_error: "Error al eliminar doctor",
                patient_deleted: "Paciente eliminado correctamente",
                patient_delete_error: "Error al eliminar paciente",
                image_loaded: "Imagen cargada correctamente",
                drag_only_images: "Por favor arrastra solo archivos de imagen",
                speech_stopped: "Lectura detenida",
                
                // Modal Titles and Dialogs
                delete_confirmation: "¿Estás seguro?",
                delete_doctor_title: "Eliminar Doctor",
                delete_doctor_msg: "¿Estás seguro de eliminar este doctor y TODOS los datos relacionados?",
                delete_patient_title: "Eliminar Paciente",
                delete_patient_msg: "¿Estás seguro de eliminar este paciente y TODOS los datos relacionados?",
                delete_appointment_title: "Eliminar Cita",
                delete_appointment_msg: "¿Estás seguro de eliminar esta cita y su diagnóstico?",
                deleting: "Eliminando...",
                yes_delete: "Sí, eliminar",
                no_cancel: "No, cancelar",
                
                // Pending Cases Board
                ai_risk: "RIESGO IA",
                ai_suggestion: "SUGERENCIA IA",
                analyzing: "Analizando...",
                waiting_alert: "ALERTA: Paciente esperando hace",
                minutes_abbr: "min.",
                final_diagnosis: "Diagnóstico Final:",
                treatment_placeholder: "Tratamiento...",
                complete_review: "Completar Revisión",
                no_appointments: "No hay citas programadas.",
                status: "Estado:",
                edit: "Editar",
                delete: "Eliminar",
                
                // Status Values
                status_pending: "pendiente",
                status_completed: "completado",
                status_cancelled: "cancelado",
                
                // Disease Names
                disease_acne: "Acné",
                disease_keratosis: "Queratosis / Carcinoma",
                disease_melanoma: "Melanoma",
                disease_psoriasis: "Psoriasis",
                
                // Time indicators
                minutes_ago: "hace {n} min",
                urgent_review: "⚠️ REVISIÓN URGENTE"
            },
            en: {
                // Navbar
                nav_home: "Home",
                nav_features: "Features",
                nav_how: "How It Works",
                nav_download: "Download",
                nav_login: "Sign In",
                
                // Loader
                loader_text: "Loading experience...",
                
                // Hero
                hero_badge: "Advanced medical technology",
                hero_title: "Early Detection of Skin Problems at Your Fingertips",
                hero_desc: "SkinXpert uses advanced artificial intelligence to detect skin cancers and other dermatological problems. Our AI analyzes, prioritizes by urgency, and connects patients with specialists for accurate diagnoses.",
                hero_btn1: "Get Started",
                hero_btn2: "Download App",
                hero_feat1: "Analysis in seconds",
                hero_feat2: "Privacy guaranteed",
                hero_feat3: "Easy to use",
                hero_tagline: "Intelligent detection of<br>skin diseases",
                
                // Features
                feat_title: "Main Features",
                feat_desc: "Cutting-edge medical technology designed to care for your skin with the utmost precision and ease.",
                feat1_title: "Advanced AI",
                feat1_desc: "Deep learning algorithms specialized in detecting skin cancers and dermatological diseases.",
                feat2_title: "AI Analysis and Medical Review",
                feat2_desc: "Capture a photo of your skin. The AI analyzes and detects potential problems, assigning an urgency level.",
                feat3_title: "100% Private",
                feat3_desc: "Your health data is encrypted and never shared. Your privacy is our priority.",
                feat4_title: "Complete History",
                feat4_desc: "Save and compare analyses over time to monitor changes in your skin.",
                feat5_title: "Smart Alerts",
                feat5_desc: "Receive notifications if we detect significant changes that require medical attention.",
                feat6_title: "Proactive Prevention",
                feat6_desc: "Detect early problems when they are most treatable. Your health comes first.",
                
                // How it works
                how_title: "How It Works",
                how_desc: "In just 3 simple steps, you can get a professional analysis of your skin.",
                step1_title: "Capture",
                step1_desc: "Take a clear photo of the skin area you want to analyze using your smartphone",
                step2_title: "Analysis",
                step2_desc: "Our AI analyzes the image in seconds, comparing it with thousands of dermatological cases",
                step3_title: "Results",
                step3_desc: "Receive a detailed report with recommendations and if necessary, consult a specialist",
                
                // Testimonials
                test_title: "What Our Users Say",
                test_desc: "Thousands of people trust SkinXpert to care for their dermatological health.",
                test1_text: "This app helped me detect a suspicious mole that was later confirmed by my dermatologist. Early detection made all the difference.",
                test1_author: "María González",
                test1_role: "SkinXpert User",
                test2_text: "Very easy to use and fast. It gives me peace of mind to be able to monitor my skin regularly without having to wait for medical appointments.",
                test2_author: "Carlos Ruiz",
                test2_role: "SkinXpert User",
                test3_text: "The interface is intuitive and the results are clear. Excellent tool for preventive skin care.",
                test3_author: "Ana Martínez",
                test3_role: "SkinXpert User",
                
                // Download
                down_title: "Download SkinXpert",
                down_desc: "Available for iOS and Android. Start caring for your dermatological health today.",
                down_ios: "iOS",
                down_ios_desc: "Compatible with iPhone and iPad.<br>Requires iOS 14.0 or higher.",
                down_ios_btn: "Download on App Store",
                down_android: "Android",
                down_android_desc: "Compatible with Android devices.<br>Requires Android 8.0 or higher.",
                down_android_btn: "Download on Google Play",
                
                // CTA
                cta_title: "Protect Your Skin Today",
                cta_desc: "Early detection can save lives. Download SkinXpert and start caring for your dermatological health with the confidence of advanced medical technology.",
                cta_btn: "Access the Platform",
                cta_note: "System available for doctors and patients",
                
                // Footer
                footer_desc: "Advanced medical technology for early detection of skin problems. Your dermatological health is our priority.",
                footer_links: "Links",
                footer_about: "About Us",
                footer_privacy: "Privacy",
                footer_terms: "Terms of Use",
                footer_support: "Support",
                footer_contact: "Contact",
                footer_copyright: "© 2025 SkinXpert. All rights reserved.",
                footer_cookies: "Cookies",
                
                // Login
                login_subtitle: "Sign in to continue",
                login_email: "Email or ID number",
                login_password: "Password",
                login_btn: "Sign In",
                login_back: "Back to home",
                
                // Notifications
                install_app: "Install App",
                
                // Patient Dashboard
                patient_hello: "Hello",
                patient_role: "Patient",
                dark_mode: "Dark Mode",
                logout: "Logout",
                tab_consultation: "Consultation",
                tab_appointments: "Appointments",
                tab_history: "History",
                tab_minixpert: "Mini-Xpert",
                new_consultation: "New Consultation",
                new_consultation_desc: "Upload a photo of your lesion for your doctor to evaluate",
                select_file: "Select File",
                use_camera: "Use Camera",
                delete_photo: "Delete Photo",
                send_consultation: "Send Consultation",
                voice_assistant: "Mini-Xpert Voice Assistant",
                voice_desc: "Listen to your medical information in audio format",
                read_history: "Read History",
                read_appointments: "Read Appointments",
                appointment_with: "Appointment with",
                stop: "Stop",
                reading: "Reading...",
                take_photo: "Take Photo",
                
                // Doctor Dashboard
                doctor_role: "Dermatology",
                tab_pending: "Pending",
                tab_patients: "Patients",
                tab_schedule: "Schedule",
                tab_camera: "Camera",
                sorted_urgency: "Sorted by Urgency (AI)",
                search_patient: "Search patient...",
                dermatoscope_viewer: "Dermatoscope Viewer",
                start: "Start",
                
                // Admin Dashboard
                admin_panel: "Admin Panel",
                tab_doctors: "Doctors",
                search_doctor: "Search doctor...",
                new_doctor: "New Doctor",
                new_patient: "New Patient",
                
                // New Doctor Modal
                modal_new_doctor_title: "New Doctor",
                doctor_code: "Doctor Code",
                full_name: "Full Name",
                email_address: "Email address",
                temp_password: "Temporary Password",
                clinic_id_optional: "Clinic ID (optional)",
                
                // New Patient Modal
                modal_new_patient_title: "New Patient",
                dni_id: "DNI / ID",
                no_doctor_assigned: "No doctor assigned",
                
                // Modals
                cancel: "Cancel",
                save: "Save",
                confirm: "Confirm",
                
                // Notifications & Messages
                processing: "Processing...",
                app_installed: "App installed successfully!",
                required_field: "This field is required",
                invalid_email: "Invalid email",
                min_length: "Minimum {n} characters",
                
                // Image modal
                full_image: "Full image",
                
                // Toast Messages
                camera_access_error: "Could not access camera. Check permissions",
                select_image_first: "Please select an image first",
                consultation_sent: "Consultation sent. AI is analyzing your case",
                send_consultation_error: "Error sending consultation",
                server_connection_error: "Could not connect to server",
                complete_fields: "Please fill all fields correctly",
                wrong_credentials: "Incorrect credentials",
                welcome: "Welcome!",
                connection_error: "Connection error",
                dark_mode_on: "Dark mode activated",
                light_mode_on: "Light mode activated",
                write_notes: "Please write some notes for the patient",
                report_sent: "Report sent successfully",
                report_send_error: "Connection error when sending report",
                appointment_updated: "Appointment updated successfully",
                appointment_update_error: "Error updating appointment",
                appointment_delete_error: "Error deleting appointment",
                appointment_deleted: "Appointment deleted successfully",
                camera_not_available: "Camera not available",
                doctor_deleted: "Doctor deleted successfully",
                doctor_delete_error: "Error deleting doctor",
                patient_deleted: "Patient deleted successfully",
                patient_delete_error: "Error deleting patient",
                image_loaded: "Image loaded successfully",
                drag_only_images: "Please drag only image files",
                speech_stopped: "Speech stopped",
                
                // Modal Titles and Dialogs
                delete_confirmation: "Are you sure?",
                delete_doctor_title: "Delete Doctor",
                delete_doctor_msg: "Are you sure you want to delete this doctor and ALL related data?",
                delete_patient_title: "Delete Patient",
                delete_patient_msg: "Are you sure you want to delete this patient and ALL related data?",
                delete_appointment_title: "Delete Appointment",
                delete_appointment_msg: "Are you sure you want to delete this appointment and its diagnosis?",
                deleting: "Deleting...",
                yes_delete: "Yes, delete",
                no_cancel: "No, cancel",
                
                // Pending Cases Board
                ai_risk: "AI RISK",
                ai_suggestion: "AI SUGGESTION",
                analyzing: "Analyzing...",
                waiting_alert: "ALERT: Patient waiting for",
                minutes_abbr: "min.",
                final_diagnosis: "Final Diagnosis:",
                treatment_placeholder: "Treatment...",
                complete_review: "Complete Review",
                no_appointments: "No appointments scheduled.",
                status: "Status:",
                edit: "Edit",
                delete: "Delete",
                
                // Status Values
                status_pending: "pending",
                status_completed: "completed",
                status_cancelled: "cancelled",
                
                // Disease Names
                disease_acne: "Acne",
                disease_keratosis: "Keratosis / Carcinoma",
                disease_melanoma: "Melanoma",
                disease_psoriasis: "Psoriasis",
                
                // Time indicators
                minutes_ago: "{n} min ago",
                urgent_review: "⚠️ URGENT REVIEW"
            }
        };

        // Variable global del idioma actual
        let currentLang = localStorage.getItem('skinxpert_lang') || 'es';

        // Función para cambiar idioma
        function toggleLanguage() {
            currentLang = currentLang === 'es' ? 'en' : 'es';
            localStorage.setItem('skinxpert_lang', currentLang);
            applyTranslations();
            document.getElementById('langToggleText').textContent = currentLang === 'es' ? 'EN' : 'ES';
        }

        // Función para aplicar traducciones
        function applyTranslations() {
            const lang = translations[currentLang];
            
            // Actualizar elementos con data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (lang[key]) {
                    el.textContent = lang[key];
                }
            });
            
            // Actualizar elementos específicos por ID (textos que no tienen data-i18n)
            const updates = {
                // Loader
                '.loader-subtext': lang.loader_text,
                
                // Hero section
                '.hero-badge': `<i class="fa-solid fa-check-circle"></i> ${lang.hero_badge}`,
                '.hero-title': lang.hero_title,
                '.hero-description': lang.hero_desc,
                '.hero-buttons .btn-primary': `${lang.hero_btn1} <i class="fa-solid fa-arrow-right"></i>`,
                '.hero-buttons .btn-outline': `${lang.hero_btn2} <i class="fa-solid fa-download"></i>`,
                '.phone-brand-tagline': lang.hero_tagline,
                
                // Features
                '#caracteristicas .section-title': lang.feat_title,
                '#caracteristicas .section-description': lang.feat_desc,
                
                // How it works
                '#como-funciona .section-title': lang.how_title,
                '#como-funciona .section-description': lang.how_desc,
                '#step1 h3': lang.step1_title,
                '#step1 p': lang.step1_desc,
                '#step2 h3': lang.step2_title,
                '#step2 p': lang.step2_desc,
                '#step3 h3': lang.step3_title,
                '#step3 p': lang.step3_desc,
                
                // Testimonials
                '#testimonios .section-title': lang.test_title,
                '#testimonios .section-description': lang.test_desc,
                
                // Download
                '#descargar .section-title': lang.down_title,
                '#descargar .section-description': lang.down_desc,
                
                // CTA
                '.cta-title': lang.cta_title,
                '.cta-description': lang.cta_desc,
                '.cta-note': lang.cta_note,
                
                // Footer
                '.footer-brand p': lang.footer_desc,
                '.footer-copyright': lang.footer_copyright,
                
                // Login
                '#loginPage p': lang.login_subtitle,
                
                // Install button
                '#installPWA span': lang.install_app
            };
            
            Object.keys(updates).forEach(selector => {
                const el = document.querySelector(selector);
                if (el) {
                    if (updates[selector].includes('<')) {
                        el.innerHTML = updates[selector];
                    } else {
                        el.textContent = updates[selector];
                    }
                }
            });
            
            // Actualizar placeholders
            const placeholders = {
                '#email': lang.login_email,
                '#password': lang.login_password
            };
            
            Object.keys(placeholders).forEach(selector => {
                const el = document.querySelector(selector);
                if (el) el.placeholder = placeholders[selector];
            });
            
            // Actualizar feature cards
            const features = document.querySelectorAll('.feature-card');
            if (features.length >= 6) {
                features[0].querySelector('.feature-title').textContent = lang.feat1_title;
                features[0].querySelector('.feature-description').textContent = lang.feat1_desc;
                features[1].querySelector('.feature-title').textContent = lang.feat2_title;
                features[1].querySelector('.feature-description').textContent = lang.feat2_desc;
                features[2].querySelector('.feature-title').textContent = lang.feat3_title;
                features[2].querySelector('.feature-description').textContent = lang.feat3_desc;
                features[3].querySelector('.feature-title').textContent = lang.feat4_title;
                features[3].querySelector('.feature-description').textContent = lang.feat4_desc;
                features[4].querySelector('.feature-title').textContent = lang.feat5_title;
                features[4].querySelector('.feature-description').textContent = lang.feat5_desc;
                features[5].querySelector('.feature-title').textContent = lang.feat6_title;
                features[5].querySelector('.feature-description').textContent = lang.feat6_desc;
            }
            
            // Actualizar testimonials
            const testimonials = document.querySelectorAll('.testimonial-card');
            if (testimonials.length >= 3) {
                testimonials[0].querySelector('.testimonial-text').textContent = lang.test1_text;
                testimonials[0].querySelector('.testimonial-author').textContent = lang.test1_author;
                testimonials[0].querySelector('.testimonial-role').textContent = lang.test1_role;
                testimonials[1].querySelector('.testimonial-text').textContent = lang.test2_text;
                testimonials[1].querySelector('.testimonial-author').textContent = lang.test2_author;
                testimonials[1].querySelector('.testimonial-role').textContent = lang.test2_role;
                testimonials[2].querySelector('.testimonial-text').textContent = lang.test3_text;
                testimonials[2].querySelector('.testimonial-author').textContent = lang.test3_author;
                testimonials[2].querySelector('.testimonial-role').textContent = lang.test3_role;
            }
            
            // Actualizar download cards
            const downloadCards = document.querySelectorAll('.download-card');
            if (downloadCards.length >= 2) {
                downloadCards[0].querySelector('.download-platform').textContent = lang.down_ios;
                downloadCards[0].querySelector('.download-description').innerHTML = lang.down_ios_desc;
                downloadCards[0].querySelector('.download-btn').innerHTML = `<i class="fa-solid fa-download"></i> ${lang.down_ios_btn}`;
                downloadCards[1].querySelector('.download-platform').textContent = lang.down_android;
                downloadCards[1].querySelector('.download-description').innerHTML = lang.down_android_desc;
                downloadCards[1].querySelector('.download-btn').innerHTML = `<i class="fa-solid fa-download"></i> ${lang.down_android_btn}`;
            }
            
            // Actualizar CTA button
            const ctaBtn = document.querySelector('.cta-buttons .btn-white');
            if (ctaBtn) ctaBtn.innerHTML = `<i class="fa-solid fa-right-to-bracket"></i> ${lang.cta_btn}`;
            
            // Actualizar footer sections
            const footerSections = document.querySelectorAll('.footer-section');
            if (footerSections.length >= 2) {
                footerSections[0].querySelector('h4').textContent = lang.footer_links;
                const footerLinks = footerSections[0].querySelectorAll('a');
                if (footerLinks.length >= 4) {
                    footerLinks[0].textContent = lang.footer_about;
                    footerLinks[1].textContent = lang.footer_privacy;
                    footerLinks[2].textContent = lang.footer_terms;
                    footerLinks[3].textContent = lang.footer_support;
                }
                footerSections[1].querySelector('h4').textContent = lang.footer_contact;
            }
            
            // Actualizar footer legal links
            const footerLegal = document.querySelectorAll('.footer-legal a');
            if (footerLegal.length >= 3) {
                footerLegal[0].textContent = lang.footer_privacy;
                footerLegal[1].textContent = lang.footer_terms;
                footerLegal[2].textContent = lang.footer_cookies;
            }
            
            // Actualizar step indicators
            const stepLabels = document.querySelectorAll('.step-label');
            if (stepLabels.length >= 3) {
                stepLabels[0].textContent = lang.step1_title;
                stepLabels[1].textContent = lang.step2_title;
                stepLabels[2].textContent = lang.step3_title;
            }
            
            // Actualizar hero features
            const heroFeatures = document.querySelectorAll('.hero-feature');
            if (heroFeatures.length >= 3) {
                heroFeatures[0].innerHTML = `<i class="fa-solid fa-check-circle" style="color: var(--sk-blue-light);"></i> ${lang.hero_feat1}`;
                heroFeatures[1].innerHTML = `<i class="fa-solid fa-check-circle" style="color: var(--sk-blue-light);"></i> ${lang.hero_feat2}`;
                heroFeatures[2].innerHTML = `<i class="fa-solid fa-check-circle" style="color: var(--sk-blue-light);"></i> ${lang.hero_feat3}`;
            }
            
            // Actualizar botón de login y back
            const loginBtn = document.querySelector('#loginPage button[onclick="handleLogin()"]');
            if (loginBtn) loginBtn.textContent = lang.login_btn;
            
            const backBtn = document.querySelector('#loginPage button[onclick="showLanding()"]');
            if (backBtn) backBtn.innerHTML = `<i class="fa-solid fa-arrow-left"></i> ${lang.login_back}`;
            
            // PATIENT DASHBOARD
            const patientRole = document.querySelector('#patientDashboard .role-badge');
            if (patientRole) patientRole.textContent = lang.patient_role;
            
            const darkModeBtn = document.querySelector('#patientDashboard .dark-mode-toggle span');
            if (darkModeBtn) darkModeBtn.textContent = lang.dark_mode;
            
            const logoutBtns = document.querySelectorAll('button[onclick="logout()"]');
            logoutBtns.forEach(btn => {
                if (btn.textContent.includes('Salir') || btn.textContent.includes('Logout')) {
                    btn.textContent = lang.logout;
                }
            });
            
            // Patient tabs
            const patientTabs = document.querySelectorAll('#patientDashboard .tab-btn');
            if (patientTabs.length >= 4) {
                patientTabs[0].textContent = lang.tab_consultation;
                patientTabs[1].textContent = lang.tab_appointments;
                patientTabs[2].textContent = lang.tab_history;
                patientTabs[3].textContent = lang.tab_minixpert;
            }
            
            // New consultation section
            const consultTitle = document.querySelector('#p-consult h3');
            if (consultTitle) consultTitle.textContent = lang.new_consultation;
            
            const consultDesc = document.querySelector('#p-consult p');
            if (consultDesc && consultDesc.textContent.includes('lesión') || consultDesc.textContent.includes('lesion')) {
                consultDesc.textContent = lang.new_consultation_desc;
            }
            
            // Upload buttons
            const selectFileBtn = document.querySelector('button[onclick="document.getElementById(\'uploadImage\').click()"]');
            if (selectFileBtn) selectFileBtn.innerHTML = `<i class="fa-solid fa-folder-open"></i> ${lang.select_file}`;
            
            const cameraBtn = document.querySelector('button[onclick="captureFromCamera()"]');
            if (cameraBtn) cameraBtn.innerHTML = `<i class="fa-solid fa-camera"></i> ${lang.use_camera}`;
            
            const deletePhotoBtn = document.getElementById('deletePhotoBtn');
            if (deletePhotoBtn) deletePhotoBtn.innerHTML = `<i class="fa-solid fa-trash"></i> ${lang.delete_photo}`;
            
            const uploadBtn = document.getElementById('uploadBtn');
            if (uploadBtn) uploadBtn.textContent = lang.send_consultation;
            
            // Mini-Xpert section
            const miniXpertTitle = document.querySelector('#p-minixpert h3');
            if (miniXpertTitle) miniXpertTitle.innerHTML = `Mini<span class="brand-x">X</span>pert ${lang.voice_assistant.replace('Mini-Xpert ', '')}`;
            
            const miniXpertDesc = document.querySelector('#p-minixpert p');
            if (miniXpertDesc && (miniXpertDesc.textContent.includes('información médica') || miniXpertDesc.textContent.includes('medical information'))) {
                miniXpertDesc.textContent = lang.voice_desc;
            }
            
            const readHistoryBtn = document.querySelector('button[onclick="readHistory()"]');
            if (readHistoryBtn) readHistoryBtn.innerHTML = `<i class="fa-solid fa-volume-high"></i> ${lang.read_history}`;
            
            const readAppointmentsBtn = document.querySelector('button[onclick="readAppointments()"]');
            if (readAppointmentsBtn) readAppointmentsBtn.innerHTML = `<i class="fa-solid fa-calendar-check"></i> ${lang.read_appointments}`;
            
            const stopSpeechBtn = document.getElementById('stopSpeechBtn');
            if (stopSpeechBtn) stopSpeechBtn.innerHTML = `<i class="fa-solid fa-stop"></i> ${lang.stop}`;
            
            const speechStatusText = document.getElementById('speechStatusText');
            if (speechStatusText) speechStatusText.textContent = lang.reading;
            
            // DOCTOR DASHBOARD
            const doctorRole = document.querySelector('#doctorDashboard .role-badge');
            if (doctorRole) doctorRole.textContent = lang.doctor_role;
            
            const doctorDarkMode = document.getElementById('darkModeTextDoctor');
            if (doctorDarkMode) doctorDarkMode.textContent = lang.dark_mode;
            
            // Doctor tabs
            const doctorTabs = document.querySelectorAll('#doctorDashboard .tab-btn');
            if (doctorTabs.length >= 4) {
                doctorTabs[0].textContent = lang.tab_pending;
                doctorTabs[1].textContent = lang.tab_patients;
                doctorTabs[2].textContent = lang.tab_schedule;
                doctorTabs[3].textContent = lang.tab_camera;
            }
            
            // Sorted by urgency
            const sortedText = document.querySelector('#d-pending p');
            if (sortedText && (sortedText.textContent.includes('Ordenado') || sortedText.textContent.includes('Sorted'))) {
                sortedText.innerHTML = `<i class="fa-solid fa-arrow-down-short-wide"></i> ${lang.sorted_urgency}`;
            }
            
            // Search patient
            const patientSearch = document.getElementById('patientSearch');
            if (patientSearch) patientSearch.placeholder = lang.search_patient;
            
            // Dermatoscope
            const dermatoscopeTitle = document.querySelector('#d-camera h3');
            if (dermatoscopeTitle) dermatoscopeTitle.textContent = lang.dermatoscope_viewer;
            
            const startCameraBtn = document.getElementById('btnCamera');
            if (startCameraBtn) startCameraBtn.innerHTML = `<i class="fa-solid fa-camera"></i> ${lang.start}`;
            
            // ADMIN DASHBOARD
            const adminTitle = document.querySelector('#adminDashboard h2');
            if (adminTitle && (adminTitle.textContent.includes('Panel Admin') || adminTitle.textContent.includes('Admin Panel'))) {
                adminTitle.textContent = lang.admin_panel;
            }
            
            const adminDarkMode = document.getElementById('darkModeTextAdmin');
            if (adminDarkMode) adminDarkMode.textContent = lang.dark_mode;
            
            // Admin tabs
            const adminTabs = document.querySelectorAll('#adminDashboard .tab-btn');
            if (adminTabs.length >= 2) {
                adminTabs[0].textContent = lang.tab_doctors;
                adminTabs[1].textContent = lang.tab_patients;
            }
            
            // Search boxes
            const doctorSearchInput = document.getElementById('doctorSearch');
            if (doctorSearchInput) doctorSearchInput.placeholder = lang.search_doctor;
            
            const adminPatientSearch = document.getElementById('adminPatientSearch');
            if (adminPatientSearch) adminPatientSearch.placeholder = lang.search_patient;
            
            // New doctor/patient buttons
            const newDoctorBtn = document.querySelector('button[onclick*="openNewDoctor"]');
            if (newDoctorBtn) newDoctorBtn.innerHTML = `<i class="fa-solid fa-plus"></i> ${lang.new_doctor}`;
            
            const newPatientBtn = document.querySelector('button[onclick*="openNewPatient"]');
            if (newPatientBtn) newPatientBtn.innerHTML = `<i class="fa-solid fa-plus"></i> ${lang.new_patient}`;
            
            // MODALS
            const modalCancel = document.querySelector('.modal-actions .btn-secondary');
            if (modalCancel && (modalCancel.textContent === 'Cancelar' || modalCancel.textContent === 'Cancel')) {
                modalCancel.textContent = lang.cancel;
            }
            
            const modalSave = document.getElementById('modalSaveBtn');
            if (modalSave && (modalSave.textContent === 'Guardar' || modalSave.textContent === 'Save')) {
                modalSave.textContent = lang.save;
            }
            
            // Actualizar título de la página
            if (currentLang === 'es') {
                document.title = 'SkinXpert - Detección Inteligente de Problemas de Piel';
            } else {
                document.title = 'SkinXpert - Intelligent Skin Problem Detection';
            }
            
            // Image modal
            const modalImage = document.getElementById('modalImage');
            if (modalImage) modalImage.alt = lang.full_image;
        }

        // Aplicar idioma al cargar
        document.addEventListener('DOMContentLoaded', () => {
            applyTranslations();
            document.getElementById('langToggleText').textContent = currentLang === 'es' ? 'EN' : 'ES';
        });
    </script>

</body>
</html>
